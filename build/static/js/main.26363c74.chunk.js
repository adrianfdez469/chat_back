(this.webpackJsonpchat_front=this.webpackJsonpchat_front||[]).push([[0],{102:function(e,t){},105:function(e,t,a){},106:function(e,t,a){"use strict";a.r(t);var n,c=a(0),o=a.n(c),i=a(23),l=a.n(i),s=(a(50),a(1)),r=Object(s.atom)({key:"idiomaState",default:"es"}),u=Object(s.atom)({key:"loginData",default:null}),m=Object(s.atom)({key:"chatConversation",default:{active:!1}}),d=Object(s.atom)({key:"contactListState",default:[]}),v={posibleViews:{LOGIN:"LOGIN",CONTACTS:"CONTACTS",CHAT:"CHAT"},getAtom:Object(s.atom)({key:"view",default:"LOGIN"})},f=Object(s.atom)({key:"backdropState",default:!1}),b=Object(s.atom)({key:"subscribeToEventsState",default:!1}),k=a(2),O=a(12),g=a(43),E=a.n(g),p={server:"https://shut-app-back.herokuapp.com"},j={getSocket:function(){return n||(n=E()(p.server))}},h=function(e){var t=Object(s.useRecoilValue)(r),a=Object(s.useSetRecoilState)(v.getAtom),n=Object(s.useSetRecoilState)(b),i=Object(s.useSetRecoilState)(f),l=Object(c.useState)({nickname:"",valid:null}),u=Object(k.a)(l,2),m=u[0],d=u[1],g=function(e){i(!0),j.getSocket().emit("new user",{nickname:e}),n(!0),a(v.posibleViews.CONTACTS),i(!1)};return o.a.createElement("div",{className:"login"},o.a.createElement("h2",null,O.welcome[t]),o.a.createElement("input",{type:"text",placeholder:O.placeholder[t],onChange:function(e){var t=e.target.value;/^[a-zA-Z][a-zA-Z0-9]{2,10}$/.test(t)?d({nickname:t,valid:!0}):d({nickname:t,valid:!1})},onKeyPress:function(e){13===e.charCode&&g(m.nickname)},value:m.nickname,className:m.valid?"valid":"invalid"}),m.valid?o.a.createElement("button",{onClick:function(){return g(m.nickname)}},O.txtBtn[t]):null)},x=a(4),S=a(3),N=function(e){var t=e.size,a=void 0===t?1:t,n=e.novistos,c=void 0===n?0:n,i={width:"".concat(50*a,"px"),height:"".concat(50*a,"px")},l={width:"".concat(20*a,"px"),height:"".concat(20*a,"px")},s={width:"".concat(35*a,"px"),height:"".concat(30*a,"px")},r=c.toString().length<=3?3*c.toString().length:10,u={top:"-".concat(r,"px"),right:"-".concat(r,"px")};return o.a.createElement("div",{className:"avatar"},o.a.createElement("div",{className:"avatarOut",style:i},o.a.createElement("div",{className:"avatarHead",style:l}),o.a.createElement("div",{className:"avatarTrunk",style:s})),c>0?o.a.createElement("span",{className:"badge",style:u},c):null)},y=function(e){var t,a,n=e.nickname,c=e.socketId,i=Object(s.useRecoilState)(m),l=Object(k.a)(i,2),r=l[0],u=l[1],d=Object(s.useSetRecoilState)(v.getAtom),f=(null===(t=r[c])||void 0===t?void 0:t.novistos)?r[c].novistos:0,b="";r[c]&&r[c].text&&(b=(null===(a=r[c].text[r[c].text.length-1])||void 0===a?void 0:a.msg)?r[c].text[r[c].text.length-1].msg:"");return o.a.createElement("div",{className:"contact contact-item",onClick:function(){var e=Object(S.a)(Object(S.a)({},r),{},{active:c,activeOnline:!0});e[c]?e[c]={nickname:n,socketId:c,text:Object(x.a)(r[c].text),novistos:0}:e[c]={nickname:n,text:[],socketId:c,novistos:0},u(e),d(v.posibleViews.CHAT)}},o.a.createElement(N,{novistos:f}),o.a.createElement("div",{className:"contactBody"},o.a.createElement("div",{className:"status"},o.a.createElement("span",{className:"nickname"},n),o.a.createElement("span",{className:"connectionStatus"})),o.a.createElement("div",{className:"lastMsg"},b)))},I=function(e){var t=Object(s.useRecoilValue)(d);return o.a.createElement("div",{style:{overflowY:"scroll",height:"calc(100% - 70px)"}},t.map((function(e){return o.a.createElement("div",{key:e.socketId},o.a.createElement(y,{nickname:e.nick,socketId:e.socketId}))})))},C=a(44),R=function(e){var t=e.myMsg,a=void 0===t||t,n=e.msg,c=e.style,i=a?"mymsg":"notmymsg";return o.a.createElement("div",{className:"message ".concat(i),style:c},n)},w=function(e){var t=e.nickname,a=e.backClick,n=e.online,c=void 0===n||n;return o.a.createElement("div",{className:"contact contact-chat"},o.a.createElement("div",{className:"goBack",onClick:a}),o.a.createElement(N,{size:.8}),o.a.createElement("div",{className:"contactBody"},o.a.createElement("div",{className:"status"},o.a.createElement("span",{className:"nickname"},t),o.a.createElement("span",{className:"connectionStatus ".concat(c?"online":"offline")},c?"Online":"Offline"))))},T=function(e){var t=Object(s.useRecoilValue)(r),a=Object(s.useRecoilValue)(u),n=Object(s.useRecoilState)(m),i=Object(k.a)(n,2),l=i[0],d=i[1],f=Object(c.useRef)(""),b=Object(s.useSetRecoilState)(v.getAtom),O=j.getSocket(),g=function(){var e=f.current.innerText.replace(/^(\s*\r*)(.)(\s*\r*)$/,"$2");if(""!==e){var t=Object(S.a)({},l);t[t.active]=Object(S.a)({},t[l.active]),t[t.active].text=[].concat(Object(x.a)(t[t.active].text),[{myMsg:!0,msg:e}]),d(t),O.emit("message",{from:a.socketId,toUserId:l.active,toSocketId:l[l.active].socketId,msg:e}),f.current.innerText="",f.current.focus()}};Object(c.useEffect)((function(){var e=document.getElementById("chatConversation");e&&(e.scrollTop=e.scrollHeight)}));return o.a.createElement("div",{id:"chatContainer"},o.a.createElement(w,{backClick:function(){b(v.posibleViews.CONTACTS),d(Object(S.a)(Object(S.a)({},l),{},{active:null}))},nickname:l[l.active].nickname,online:l.activeOnline}),o.a.createElement("div",{id:"chatConversation"},l[l.active].text.map((function(e,t,a){var n={};return a[t+1]&&e.myMsg===a[t+1].myMsg&&(n.marginBottom="-3px",n.borderRadius=e.myMsg?"10px 0px 10px 10px":"0 10px 10px 10px"),t>0&&e.myMsg===a[t-1].myMsg&&(n.borderRadius=(e.myMsg,"10px 10px 10px 10px")),o.a.createElement(R,Object.assign({},e,{key:t,style:n}))}))),o.a.createElement("div",{id:"editor"},o.a.createElement("div",{id:"textarea",role:"textbox",contentEditable:l.activeOnline,ref:f,onKeyPress:function(e){l.activeOnline&&13===e.charCode&&g()}}),o.a.createElement("button",{id:"sendButton",disabled:!l.activeOnline,onClick:g},C.btnSend[t])))},A=function(e){var t=Object(s.useRecoilState)(r),a=Object(k.a)(t,2),n=a[0],c=a[1];return o.a.createElement("div",{className:"headerdiv"},o.a.createElement("div",{className:"infoapp"},o.a.createElement("div",{className:"apptitle"},"Chatapp")),o.a.createElement("select",{value:n,onChange:function(e){var t=e.target.value;c(t)},className:"idiomaselect"},o.a.createElement("option",{value:"es"},"ES"),o.a.createElement("option",{value:"en"},"EN")))},V=function(e){var t=Object(s.useRecoilState)(d),a=Object(k.a)(t,2),n=a[0],i=a[1],l=Object(s.useSetRecoilState)(u),r=j.getSocket();return Object(c.useEffect)((function(){return r.on("new user",(function(e){Array.isArray(e)?(i(e.filter((function(e){return e.socketId!==r.id}))),l(e.find((function(e){return e.socketId===r.id})))):i([].concat(Object(x.a)(n),[{nick:e.nickname,_id:e._id,socketId:e.socketId}]))})),function(){return r.off("new user")}}),[n]),o.a.createElement(o.a.Fragment,null)},B=function(e){var t=Object(s.useRecoilState)(d),a=Object(k.a)(t,2),n=a[0],i=a[1],l=Object(s.useRecoilState)(m),r=Object(k.a)(l,2),u=r[0],v=r[1],f=j.getSocket();return Object(c.useEffect)((function(){return f.on("user disconnect",(function(e){i(n.filter((function(t){return t.socketId!==e.socketId}))),u.active===e.socketId&&v(Object(S.a)(Object(S.a)({},u),{},{activeOnline:!1}))})),function(){return f.off("user disconnect")}}),[u]),o.a.createElement(o.a.Fragment,null)},M=function(e){var t=Object(s.useRecoilState)(m),a=Object(k.a)(t,2),n=a[0],i=a[1],l=j.getSocket();return Object(c.useEffect)((function(){return l.on("message",(function(e){var t=Object(S.a)({},n);n[e.socketId]?(t[e.socketId]=Object(S.a)({},n[e.socketId]),n[e.socketId].text?(t[e.socketId].text=[].concat(Object(x.a)(n[e.socketId].text),[{myMsg:!1,msg:e.msg}]),e.socketId!==t.active&&(t[e.socketId].novistos=t[e.socketId].novistos+1)):t[e.socketId].text=[]):t[e.socketId]={text:[{myMsg:!1,msg:e.msg}],nickname:null,socketId:null,novistos:1},i(t)})),function(){return l.off("message")}}),[n]),o.a.createElement(o.a.Fragment,null)},L=(a(105),function(e){var t=Object(s.useRecoilValue)(f);return t?(console.log("se muestra backdrop ".concat(t)),o.a.createElement("div",{className:"backdrop"},o.a.createElement("div",{class:"loader"},"Loading..."))):null});var z=function(){var e=Object(s.useRecoilValue)(v.getAtom),t=Object(s.useRecoilValue)(b),a=e===v.posibleViews.LOGIN?o.a.createElement(h,null):e===v.posibleViews.CONTACTS?o.a.createElement(I,null):o.a.createElement(T,null),n=null;return t&&(n=o.a.createElement(o.a.Fragment,null,o.a.createElement(V,null),o.a.createElement(B,null),o.a.createElement(M,null))),o.a.createElement(o.a.Fragment,null,o.a.createElement(L,null),o.a.createElement("div",{className:"main"},o.a.createElement(A,null),a,n))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(s.RecoilRoot,null,o.a.createElement(z,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},12:function(e){e.exports=JSON.parse('{"welcome":{"en":"Welcome to the chat","es":"Bienvenido al chat"},"placeholder":{"en":"Nickname","es":"Nombre de pila"},"txtBtn":{"en":"Begin","es":"Comenzar"}}')},44:function(e){e.exports=JSON.parse('{"btnSend":{"es":"Enviar","en":"Send"}}')},45:function(e,t,a){e.exports=a(106)},50:function(e,t,a){}},[[45,1,2]]]);
//# sourceMappingURL=main.26363c74.chunk.js.map