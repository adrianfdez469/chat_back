(this.webpackJsonpchat_front=this.webpackJsonpchat_front||[]).push([[9],{321:function(e,t,a){"use strict";a.d(t,"d",(function(){return u})),a.d(t,"e",(function(){return d})),a.d(t,"a",(function(){return f})),a.d(t,"c",(function(){return p})),a.d(t,"b",(function(){return m}));var n=a(58),r=a.n(n),c=a(10),o=a(110),i=a(325),s=a(6),l=a(13),u=Object(s.selector)({key:"friendSelector",get:function(e){var t=e.get;return t(l.f).length>0?Object(i.a)(t(l.f)).sort((function(e,t){if(1===e.friendShipStatus&&1===t.friendShipStatus){if(e.socketId&&!t.socketId)return-1;if(!e.socketId&&t.socketId)return 1}return e.friendShipStatus<t.friendShipStatus?-1:e.friendShipStatus>t.friendShipStatus?1:e.email<t.email?-1:e.email>t.email?1:void 0})):[]},set:function(){var e=Object(o.a)(r.a.mark((function e(t,a){var n,o,s,u,d,f,p,m,g,b,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.set,o=t.get,s=a.action,u=a.payload,e.t0=s,e.next="initialize"===e.t0?5:"add"===e.t0?7:"update"===e.t0?9:"reset_cant_no_leidos"===e.t0?11:"set_message_info"===e.t0?13:"delete"===e.t0?15:"connect"===e.t0?17:"disconnect"===e.t0?19:24;break;case 5:return n(l.f,(function(e){return 0===e.length?u.friends:e})),e.abrupt("break",25);case 7:return n(l.f,(function(e){var t=Object(i.a)(e);return t.push(u.friend),t})),e.abrupt("break",25);case 9:return n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===u.friend.contactId}));return e.slice(0,t).concat([u.friend]).concat(e.slice(t+1))})),e.abrupt("break",25);case 11:return n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===u.contactId}));return e.slice(0,t).concat([Object(c.a)(Object(c.a)({},e[t]),{},{unread:0})]).concat(e.slice(t+1))})),e.abrupt("break",25);case 13:return n(l.f,(function(e){var t=u.dataObj;return e.map((function(e){if(t[e.contactId]){var a=0;return e.unread&&(a=e.unread),t[e.contactId].cantidad&&(a+=t[e.contactId].cantidad),Object(c.a)(Object(c.a)({},e),{},{unread:a,lastMsg:t[e.contactId].lastMessage,datetime:t[e.contactId].datetime})}return e}))})),e.abrupt("break",25);case 15:return n(l.f,(function(e){return e.filter((function(e){return e.contactId!==u.friendId}))})),e.abrupt("break",25);case 17:return Array.isArray(u.data)?n(l.f,(function(e){return e.map((function(e){var t=u.data.findIndex((function(t){return t.userId===e.contactId}));return t>=0?Object(c.a)(Object(c.a)({},e),{},{socketId:u.data[t].socketId}):Object(c.a)({},e)}))})):(d=u.data,f=d.userId,p=d.socketId,m=null,g=0,n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===f}));if(t>=0){m=e[t].nickname,g=e[t].friendShipStatus;var a=Object(c.a)(Object(c.a)({},e[t]),{},{socketId:p});return e.slice(0,t).concat([a]).concat(e.slice(t+1))}return e})),m&&1===g&&u.notification("".concat(m," ").concat(u.msg[o(l.h)]),{variant:"info"})),e.abrupt("break",25);case 19:return b=null,v=0,n(l.f,(function(e){var t=e.findIndex((function(e){return e.socketId===u.socketId}));return t>=0?(b=e[t].nickname,v=e[t].friendShipStatus,Object(i.a)(e).slice(0,t).concat([Object(c.a)(Object(c.a)({},e[t]),{},{socketId:null})]).concat(e.slice(t+1))):e})),b&&1===v&&u.notification("".concat(b," ").concat(u.msg[o(l.h)]),{variant:"warning"}),e.abrupt("break",25);case 24:return e.abrupt("break",25);case 25:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}),d=Object(s.selector)({key:"conversationSelector",set:function(e,t){var a=e.set,n=t.contactId,r=t.conversation,c=function(e,t,a,n){return e===a?0:t===a?n?3:2:void 0};a(Object(l.g)(n),(function(e){return r.map((function(e){return{_id:e._id,content:e.content,datetime:e.datetime,state:c(e.userOrigin,e.userDestiny,n,e.readed)}}))}))}}),f=Object(s.selector)({key:"addMessageToConversation",set:function(e,t){var a=e.set,n=t.contactId,r={_id:t.messageId,content:t.content,datetime:t.datetime,state:t.state};a(Object(l.g)(n),(function(e){return e.concat([r])}))}}),p=Object(s.selector)({key:"editMsgToStateSavedSelector",set:function(e,t){var a=e.set,n=t.contactId,r=t.messageId,o=t.datetime,i=t.consecutive;a(Object(l.g)(n),(function(e){var t=e.findIndex((function(e){return e._id===i&&1===e.state}));if(t>=0){var a=Object(c.a)(Object(c.a)({},e[t]),{},{state:2,_id:r,datetime:o});return e.slice(0,t).concat([a]).concat(e.slice(t+1))}return e}))}}),m=Object(s.selector)({key:"editAllMsgToSavedSelector",set:function(e,t){var a=e.set,n=t.contactId;a(Object(l.g)(n),(function(e){return e.map((function(e){return 0!==e.state?Object(c.a)(Object(c.a)({},e),{},{state:3}):e}))}))}})},322:function(e,t,a){"use strict";var n=a(34),r=a.n(n),c=a(104),o=a(44),i=a(24);t.a=function(){var e=Object(o.a)(),t=e.openErrorNotification,a=e.openSuccessNotification;return{postRequest:function(e){var n=e.url,o=e.bodyParams,s=void 0===o?{}:o,l=e.doFnAfterSuccess,u=void 0===l?null:l,d=e.doFnAfterError,f=void 0===d?null:d,p=e.messageOnSuccess,m=void 0===p?null:p,g=e.messageOnError,b=void 0===g?null:g;Object(c.a)((function(e){r.a.post("".concat(i.a.server).concat(n),s,{headers:{Authorization:e}}).then((function(t){m&&a(m),u&&u(t,e)})).catch((function(e){b&&t(b),f&&f(e)}))}))}}}},350:function(e,t,a){"use strict";var n=a(1),r=a(2),c=a(0),o=(a(5),a(3)),i=a(4),s=a(7),l=a(100),u=c.forwardRef((function(e,t){var a=e.classes,i=e.className,u=e.color,d=void 0===u?"primary":u,f=e.position,p=void 0===f?"fixed":f,m=Object(r.a)(e,["classes","className","color","position"]);return c.createElement(l.a,Object(n.a)({square:!0,component:"header",elevation:4,className:Object(o.a)(a.root,a["position".concat(Object(s.a)(p))],a["color".concat(Object(s.a)(d))],i,"fixed"===p&&"mui-fixed"),ref:t},m))}));t.a=Object(i.a)((function(e){var t="light"===e.palette.type?e.palette.grey[100]:e.palette.grey[900];return{root:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",zIndex:e.zIndex.appBar,flexShrink:0},positionFixed:{position:"fixed",top:0,left:"auto",right:0,"@media print":{position:"absolute"}},positionAbsolute:{position:"absolute",top:0,left:"auto",right:0},positionSticky:{position:"sticky",top:0,left:"auto",right:0},positionStatic:{position:"static"},positionRelative:{position:"relative"},colorDefault:{backgroundColor:t,color:e.palette.getContrastText(t)},colorPrimary:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText},colorSecondary:{backgroundColor:e.palette.secondary.main,color:e.palette.secondary.contrastText},colorInherit:{color:"inherit"},colorTransparent:{backgroundColor:"transparent",color:"inherit"}}}),{name:"MuiAppBar"})(u)},351:function(e,t,a){"use strict";var n=a(1),r=a(2),c=a(12),o=a(0),i=(a(5),a(3)),s=a(4),l=o.forwardRef((function(e,t){var a=e.classes,c=e.className,s=e.component,l=void 0===s?"div":s,u=e.disableGutters,d=void 0!==u&&u,f=e.variant,p=void 0===f?"regular":f,m=Object(r.a)(e,["classes","className","component","disableGutters","variant"]);return o.createElement(l,Object(n.a)({className:Object(i.a)(a.root,a[p],c,!d&&a.gutters),ref:t},m))}));t.a=Object(s.a)((function(e){return{root:{position:"relative",display:"flex",alignItems:"center"},gutters:Object(c.a)({paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},e.breakpoints.up("sm"),{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}),regular:e.mixins.toolbar,dense:{minHeight:48}}}),{name:"MuiToolbar"})(l)},375:function(e,t,a){"use strict";var n=a(84);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),c=(0,n(a(102)).default)(r.default.createElement("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"}),"ArrowBack");t.default=c},376:function(e,t,a){"use strict";var n=a(84);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),c=(0,n(a(102)).default)(r.default.createElement("path",{d:"M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done");t.default=c},377:function(e,t,a){"use strict";var n=a(84);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),c=(0,n(a(102)).default)(r.default.createElement("path",{d:"M18 7l-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41L6 19l1.41-1.41L1.83 12 .41 13.41z"}),"DoneAll");t.default=c},378:function(e){e.exports=JSON.parse('{"errorLoadConversation":{"es":"Error al cargar mensajes","en":"Error loading messages"}}')},379:function(e,t,a){"use strict";var n=a(84);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(0)),c=(0,n(a(102)).default)(r.default.createElement("path",{d:"M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"}),"Telegram");t.default=c},380:function(e){e.exports=JSON.parse('{"notEditable":{"es":"No puede enviar mensajes a este usuario","en":"Can\'t send messages to this user"}}')},435:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(19),o=a(6),i=a(321),s=a(13),l=a(109),u=a(350),d=a(351),f=a(320),p=a(83),m=a(257),g=a(373),b=a(293),v=a(4),h=a(81),O=a(79),j=a(375),x=a.n(j),k=a(338),I=a.n(k),y=a(24),S=Object(b.a)((function(e){var t;return{grow:{flexGrow:1},menuButton:{marginRight:e.spacing(.5)},title:{display:"block",marginLeft:e.spacing(1)},customAppBar:(t={width:"100%"},Object(l.a)(t,e.breakpoints.up("sm"),{width:e.breakpoints.values.sm}),Object(l.a)(t,"right","auto"),t),avatarMan:{color:e.palette.getContrastText(h.a[400]),backgroundColor:h.a[400]},avatarWoman:{color:e.palette.getContrastText(O.a[300]),backgroundColor:O.a[300]}}})),E=Object(v.a)((function(e){return{badge:{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",animation:"$ripple 1.2s infinite ease-in-out",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(g.a),w=Object(v.a)((function(e){return{badge:{backgroundColor:e.palette.grey[500],color:e.palette.grey[500],boxShadow:"0 0 0 2px ".concat(e.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",border:"1px solid currentColor",content:'""'}},"@keyframes ripple":{"0%":{transform:"scale(.8)",opacity:1},"100%":{transform:"scale(2.4)",opacity:0}}}}))(g.a),N=function(e){return e.contact.socketId&&1===e.contact.friendShipStatus?r.a.createElement(E,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},e.children):r.a.createElement(w,{overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},variant:"dot"},e.children)},R=function(e){var t=e.closeChat,a=e.contact,n=S(),c=a.avatarUrl?y.a.server+a.avatarUrl:null,o="M"===a.gender?"avatarMan":"avatarWoman";return r.a.createElement(u.a,{position:"fixed",className:n.customAppBar},r.a.createElement(d.a,null,r.a.createElement(m.a,{edge:"start",className:n.menuButton,color:"inherit","aria-label":"open drawer",onClick:t},r.a.createElement(x.a,null)),r.a.createElement(N,{contact:a},r.a.createElement(f.a,{src:c,className:a.gender&&o})),r.a.createElement(p.a,{className:n.title,variant:"h5",noWrap:!0},a.nickname),r.a.createElement("div",{className:n.grow}),r.a.createElement(m.a,{"aria-label":"show 4 new mails",color:"inherit"},r.a.createElement(I.a,null))))},M=function(){var e=Object(o.useRecoilState)(s.a),t=Object(c.a)(e,2),a=t[0],n=t[1],l=Object(o.useRecoilValue)(i.d).find((function(e){return e.contactId===a}));return r.a.createElement(R,{closeChat:function(){n(null)},contact:l})},C=function(e){return r.a.createElement(M,null)},A=a(10),L=a(78),T={50:"#f1f8e9",100:"#dcedc8",200:"#c5e1a5",300:"#aed581",400:"#9ccc65",500:"#8bc34a",600:"#7cb342",700:"#689f38",800:"#558b2f",900:"#33691e",A100:"#ccff90",A200:"#b2ff59",A400:"#76ff03",A700:"#64dd17"},_=a(376),z=a.n(_),B=a(377),D=a.n(B),V=a(431),P=a(438),F=Object(b.a)((function(e){return{message:{padding:"".concat(e.spacing(1),"px ").concat(e.spacing(2),"px"),maxWidth:"60%",marginTop:e.spacing(2),marginBottom:0,marginLeft:"".concat(e.spacing(2),"px"),marginRight:"".concat(e.spacing(2),"px"),borderRadius:"10px",backgroundColor:e.palette.info.dark,color:e.palette.info.contrastText,position:"relative"},timeMessage:Object(A.a)({paddingLeft:e.spacing(2),maxWidth:"60%",marginBottom:e.spacing(1),marginLeft:"".concat(e.spacing(2),"px"),marginRight:"".concat(e.spacing(1),"px"),color:e.palette.text.disabled},e.typography.subtitle2),mymsg:{textAlign:"right",alignSelf:"flex-end",borderRadius:"10px 0 10px 10px"},notmymsg:{alignSelf:"flex-start",borderRadius:"0 10px 10px 10px"},msgAvatar:{width:e.spacing(3),height:e.spacing(3),position:"absolute",top:"-".concat(e.spacing(1.5),"px")},myMsgAvatar:{right:"-".concat(e.spacing(1.5),"px")},notMyMsgAvatar:{left:"-".concat(e.spacing(1.5),"px")},doneIcon:{marginRight:e.spacing(1),fontSize:e.spacing(2.2)}}})),H=r.a.memo((function(e){var t=e.state,a=e.content,n=e.datetime,c=e.contact,o=e.avatarSrc,i=e.idioma,s=F(),l=t>0?s.mymsg:s.notmymsg,u=t>0?s.myMsgAvatar:s.notMyMsgAvatar,d=t>0?o:y.a.server+c.avatarUrl,p="es"===i?{locale:P.a}:{},m=Object(V.a)(new Date(n),new Date,p),g=null;return 1===t&&(g=r.a.createElement(z.a,{className:s.doneIcon,style:{color:L.a[500]}})),2===t&&(g=r.a.createElement(D.a,{className:s.doneIcon,style:{color:L.a[500]}})),3===t&&(g=r.a.createElement(D.a,{className:s.doneIcon,style:{color:T[500]}})),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"".concat(s.message," ").concat(l)},r.a.createElement(f.a,{alt:c.nickname,src:d,variant:"circle",className:"".concat(s.msgAvatar," ").concat(u)}),a),r.a.createElement("span",{className:" ".concat(l)},r.a.createElement("span",{className:"".concat(s.timeMessage)},m),g))})),W=Object(b.a)((function(e){return{chatConversation:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",height:"100%"},offset:e.mixins.toolbar,offsetDown:Object(A.a)(Object(A.a)({},e.mixins.toolbar),{},{bottom:0,position:"relative"})}})),G=function(e){var t=e.contact,a=e.avatarSrc,n=e.messages,c=e.idioma;r.a.useEffect((function(){var e=document.getElementById("chatConversation");e&&(e.scrollTop=e.scrollHeight)}));var o=W();return r.a.createElement("div",{id:"chatConversation",className:o.chatConversation},r.a.createElement("div",{className:o.offset}),n.map((function(e,n,o){return r.a.createElement(H,Object.assign({},e,{key:n,contact:t,avatarSrc:a,idioma:c}))})),r.a.createElement("div",{className:o.offsetDown}))},J=a(322),q=a(378),U=a(103),$=function(){var e=Object(o.useRecoilValue)(s.a),t=Object(o.useSetRecoilState)(i.e),a=Object(o.useRecoilValue)(Object(s.g)(e)),c=Object(o.useRecoilValue)(s.l),l=Object(o.useRecoilValue)(s.i),u=Object(o.useRecoilValue)(s.h),d=Object(o.useRecoilValue)(i.d),f=Object(J.a)().postRequest,p=d.find((function(t){return t.contactId===e}));return Object(n.useEffect)((function(){0===a.length&&f({url:"/messages/getMessagesByContact",messageOnError:q.errorLoadConversation[u],bodyParams:{contactId:p.contactId},doFnAfterSuccess:function(e,a){200===e.status&&(t({contactId:p.contactId,conversation:e.data.conversation}),U.a.getSocket().emit("read messages",{readerId:l.userId,messengerId:p.contactId,messengerSocketId:p.socketId,token:a}))}})}),[]),a?r.a.createElement(G,{contact:p,avatarSrc:c,messages:a,idioma:u}):null},Y=function(e){return r.a.createElement($,null)},K=a(44),Q=a(379),X=a.n(Q),Z=Object(b.a)((function(e){var t;return{appBar:(t={top:"auto",bottom:0,position:"fixed",width:"100%"},Object(l.a)(t,e.breakpoints.up("sm"),{width:e.breakpoints.values.sm}),Object(l.a)(t,"right","auto"),t),grow:{flexGrow:1},toolbar:{padding:0},icon:{fontSize:e.spacing(3.75)},textarea:{border:"1px solid white",fontFamily:"inherit",fontSize:"large",padding:"1px 6px",backgroundColor:e.palette.background.paper,color:e.palette.text.primary,width:"100%",marginTop:e.spacing(1),marginBottom:e.spacing(1),maxHeight:e.spacing(10),minHeight:e.spacing(4),overflowY:"auto",borderRadius:e.spacing(.5),marginLeft:e.spacing(2),cursor:"text"}}})),ee=function(e){var t=e.sendMessage,a=e.refAreaTexto,n=e.keyPress,c=Z();return r.a.createElement(u.a,{color:"primary",className:c.appBar},r.a.createElement(d.a,{variant:"dense",className:c.toolbar},r.a.createElement("div",{className:c.textarea,role:"textbox",contentEditable:!0,ref:a,onKeyPress:n}),r.a.createElement("div",{className:c.grow}),r.a.createElement(m.a,{color:"inherit",onClick:t},r.a.createElement(X.a,{className:c.icon}))))},te=a(380),ae=function(e){var t=Object(K.a)().openWarningNotification,a=Object(o.useRecoilValue)(s.i),l=Object(o.useRecoilValue)(s.h),u=Object(o.useSetRecoilState)(i.a),d=Object(o.useRecoilValue)(s.a),f=Object(o.useRecoilValue)(i.d).find((function(e){return e.contactId===d})),p=Object(n.useRef)(""),m=Object(n.useState)(0),g=Object(c.a)(m,2),b=g[0],v=g[1],h=function(){""!==p.current.innerText.replace(/^(\s*\r*)(.)(\s*\r*)$/,"$2")&&(u({contactId:f.contactId,messageId:b,content:p.current.innerText,datetime:new Date,state:1}),v((function(e){return e+1})),U.a.getSocket().emit("send message",{content:p.current.innerText,userOriginId:a.userId,userDestinyId:d,toSocketId:f.socketId,token:localStorage.getItem("token"),consecutive:b}),p.current.innerText="",p.current.focus())};return Object(n.useEffect)((function(){1===f.friendShipStatus?p.current.focus():t(te.notEditable[l])}),[]),1===f.friendShipStatus?r.a.createElement(ee,{sendMessage:h,keyPress:function(e){13===e.charCode&&(e.preventDefault(),h())},refAreaTexto:p}):null},ne=function(e){return r.a.createElement(ae,null)},re=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(C,null),r.a.createElement(Y,null),r.a.createElement(ne,null))};t.default=function(e){return r.a.createElement(re,null)}}}]);
//# sourceMappingURL=9.64867cfe.chunk.js.map