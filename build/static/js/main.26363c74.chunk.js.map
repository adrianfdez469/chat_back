{"version":3,"sources":["components/socket.js","components/recoil/atoms.js","conf/configuration.js","components/login/login.js","components/contacts/avatar.js","components/contacts/contact.js","components/contacts/contacts.js","components/chat/message.js","components/chat/friendHeader/friendHeader.js","components/chat/chat.js","components/header/header.js","components/events/newUserSubscriber.js","components/events/userDisconnectSubscriber.js","components/events/incomingMsgSubscriber.js","components/backdrop/backdrop.js","App.js","serviceWorker.js","index.js"],"names":["socket","idiomaState","atom","key","default","loginData","chatConversation","contactListState","view","posibleViews","LOGIN","CONTACTS","CHAT","getAtom","backdropState","subscribeToEventsState","DEFAULT_CONFIG","server","socketClient","getSocket","openSocket","Login","props","idioma","useRecoilValue","setView","useSetRecoilState","setSubscribeToEvents","setBackdrop","useState","nickname","valid","nick","setNick","setLogin","emit","className","text","welcome","type","placeholder","onChange","value","target","test","onKeyPress","event","charCode","onClick","txtBtn","VisualAvatar","size","novistos","styleOut","width","height","styleHead","styleBody","pos","toString","length","badgeStyle","top","right","style","Contact","socketId","useRecoilState","conversation","setConversation","cantidad","lastMessage","msg","newConversation","active","activeOnline","Contacts","contactList","overflowY","map","contact","Message","myMsg","msgStyle","FriendHeader","backClick","online","Chat","loginDataUser","setConvertation","refAreaTexto","useRef","client","sendMsg","current","innerText","replace","newStateObj","from","toUserId","toSocketId","focus","useEffect","element","document","getElementById","scrollTop","scrollHeight","id","elem","idx","arr","marginBottom","borderRadius","role","contentEditable","ref","disabled","btnSend","Header","setIdioma","UserSubscriber","setContactListState","setLoginData","on","data","Array","isArray","filter","find","_id","off","IncomingMsgSubscriber","Backdrop","useBackdrop","console","log","class","App","viewState","subscribe","cmp","subscriptions","Boolean","window","location","hostname","match","ReactDOM","render","StrictMode","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.26363c74.chunk.js","sourcesContent":["import openSocket from 'socket.io-client'; \r\nimport {DEFAULT_CONFIG} from '../conf/configuration';\r\nlet socket;\r\n\r\nconst socketClient = \r\n {   \r\n    getSocket: () => {\r\n        if(!socket){\r\n            socket = openSocket(DEFAULT_CONFIG.server);\r\n            return socket;    \r\n        }\r\n        return socket;\r\n    }\r\n};\r\n\r\nexport default socketClient;","import {atom} from 'recoil';\r\n\r\nconst idiomaState = atom({\r\n    key: 'idiomaState',\r\n    default: 'es'\r\n});\r\n\r\nconst loginData = atom({\r\n    key: 'loginData',\r\n    default: null\r\n})\r\n\r\nconst chatConversation = atom({\r\n    key: 'chatConversation',\r\n    default: {\r\n        'active': false\r\n    }\r\n});\r\n\r\nconst contactListState = atom({\r\n    key: 'contactListState',\r\n    default: []\r\n});\r\n\r\n\r\nconst view = {\r\n    posibleViews: {\r\n        LOGIN: 'LOGIN',\r\n        CONTACTS: 'CONTACTS',\r\n        CHAT: 'CHAT'\r\n    },\r\n    getAtom: atom({\r\n        key: 'view',\r\n        default: 'LOGIN'\r\n    })\r\n};\r\n\r\nconst backdropState = atom({\r\n    key: 'backdropState',\r\n    default: false\r\n});\r\n\r\nconst subscribeToEventsState = atom({\r\n    key: 'subscribeToEventsState',\r\n    default: false\r\n})\r\n\r\nexport {idiomaState, loginData, chatConversation, view, contactListState, subscribeToEventsState, backdropState};","const DEV = {\r\n    server: \"http://localhost:3001\"\r\n}\r\nconst PROD = {\r\n    server: \"https://shut-app-back.herokuapp.com\"\r\n}\r\n\r\nexport const DEFAULT_CONFIG = process.env.NODE_ENV === \"development\" ? DEV : PROD;","import React, {useState} from 'react';\r\nimport { useRecoilValue, useSetRecoilState } from 'recoil';\r\nimport {idiomaState, view, subscribeToEventsState, backdropState} from '../recoil/atoms';\r\nimport text from './idioma.json';\r\nimport socket from '../socket';\r\n\r\nconst Login = props => {\r\n    const idioma = useRecoilValue(idiomaState);\r\n    const setView = useSetRecoilState(view.getAtom);\r\n    const setSubscribeToEvents = useSetRecoilState(subscribeToEventsState);\r\n    const setBackdrop = useSetRecoilState(backdropState);\r\n    const [nick, setNick] = useState({\r\n        nickname: '', valid: null\r\n    });\r\n\r\n    const setNickName = ({target: {value}}) => {\r\n        if(/^[a-zA-Z][a-zA-Z0-9]{2,10}$/.test(value)){\r\n            setNick({nickname: value, valid: true});\r\n        }else{\r\n            setNick({nickname: value, valid: false});\r\n        }\r\n    };\r\n\r\n    const setLogin = (nickname) => {\r\n        setBackdrop(true);        \r\n        const client = socket.getSocket();\r\n        client.emit('new user', {nickname: nickname});\r\n        setSubscribeToEvents(true);\r\n        setView(view.posibleViews.CONTACTS);\r\n        setBackdrop(false);\r\n    }\r\n\r\n    const keyPress = (event) => {\r\n        if(event.charCode === 13){\r\n            setLogin(nick.nickname);\r\n        }\r\n    }\r\n    \r\n\r\n    return (\r\n        <div className='login'>\r\n            <h2>{text.welcome[idioma]}</h2>\r\n            <input type=\"text\" placeholder={text.placeholder[idioma]} \r\n                onChange={setNickName}\r\n                onKeyPress={keyPress} \r\n                value={nick.nickname} \r\n                className={nick.valid ? 'valid' : 'invalid'}                \r\n            />\r\n            {nick.valid ? <button onClick={() => setLogin(nick.nickname)}>{text.txtBtn[idioma]}</button> : null}\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Login;","import React from 'react';\r\n\r\n\r\n\r\nconst VisualAvatar = ({size = 1, novistos = 0}) => {\r\n\r\n    const styleOut = {\r\n        width: `${50*size}px`,\r\n        height: `${50*size}px`\r\n    }\r\n\r\n    const styleHead = {\r\n        width: `${20*size}px`,\r\n        height: `${20*size}px`\r\n    };\r\n\r\n    const styleBody = {\r\n        width: `${35*size}px`,\r\n        height: `${30*size}px`\r\n    }\r\n    const pos = novistos.toString().length <= 3 ? novistos.toString().length * 3 : 10; \r\n    const badgeStyle = {\r\n        top: `-${pos}px`,\r\n        right: `-${pos}px`\r\n    }\r\n\r\n    return (\r\n        <div className=\"avatar\">\r\n            <div className='avatarOut' style={styleOut}>\r\n                <div className='avatarHead' style={styleHead}></div>\r\n                <div className='avatarTrunk' style={styleBody}></div>\r\n            </div>\r\n            {novistos > 0 \r\n                ? <span className=\"badge\" style={badgeStyle}>{novistos}</span>\r\n                : null\r\n            }\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default VisualAvatar;","import React from 'react';\r\nimport {useRecoilState, useSetRecoilState} from 'recoil';\r\nimport {chatConversation, view} from '../recoil/atoms';\r\nimport VisualAvatar from './avatar';\r\n\r\nconst Contact = ({nickname, socketId}) => {\r\n    const [conversation, setConversation] = useRecoilState(chatConversation);\r\n    const setView = useSetRecoilState(view.getAtom);\r\n    \r\n    const cantidad = conversation[socketId]?.novistos ? conversation[socketId].novistos : 0;\r\n    let lastMessage = '';\r\n    if(conversation[socketId] && conversation[socketId].text){        \r\n        lastMessage = conversation[socketId].text[conversation[socketId].text.length-1]?.msg ? conversation[socketId].text[conversation[socketId].text.length-1].msg : '';\r\n    }\r\n    \r\n\r\n    const startConvertation = () => {\r\n        \r\n        const newConversation = {...conversation, active: socketId, activeOnline: true};\r\n        if(!newConversation[socketId]) {\r\n            newConversation[socketId] = {\r\n                nickname: nickname,\r\n                text: [],\r\n                socketId: socketId,\r\n                novistos: 0\r\n            };            \r\n        }else{\r\n            newConversation[socketId] = {\r\n                nickname: nickname,\r\n                socketId: socketId,\r\n                text: [...conversation[socketId].text],\r\n                novistos: 0\r\n            }\r\n        }\r\n        setConversation(newConversation);\r\n        setView(view.posibleViews.CHAT);\r\n    };  \r\n\r\n    return (\r\n        <div className='contact contact-item' onClick={startConvertation}>\r\n            <VisualAvatar novistos={cantidad}/>\r\n            <div className='contactBody'>\r\n                <div className='status'>\r\n                    <span className=\"nickname\">{nickname}</span>\r\n                    <span className=\"connectionStatus\"></span>\r\n                </div>\r\n                <div className=\"lastMsg\">{lastMessage}</div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Contact;","import React from 'react';\r\nimport Contact from './contact';\r\nimport {contactListState} from '../recoil/atoms';\r\nimport {useRecoilValue} from 'recoil';\r\n\r\nconst Contacts = props => {\r\n    \r\n    const contactList = useRecoilValue(contactListState);\r\n\r\n    const style = {\r\n        overflowY: \"scroll\",\r\n        height: 'calc(100% - 70px)'\r\n    };\r\n\r\n    return (\r\n        <div style={style}> \r\n            {contactList.map(contact => {\r\n                return <div key={contact.socketId}><Contact nickname={contact.nick} socketId={contact.socketId}/></div>\r\n            })}\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Contacts;","import React from 'react';\r\n//import './chateditor.css';\r\n\r\nconst Message = ({myMsg = true, msg, style}) => {\r\n\r\n    const msgStyle = myMsg ? 'mymsg' : 'notmymsg';\r\n\r\n    return (\r\n        <div className={`message ${msgStyle}`} style={style}>\r\n            {msg}\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Message;","import React from 'react';\r\nimport VisualAvatar from '../../contacts/avatar';\r\n\r\nconst FriendHeader = ({nickname, backClick, online = true}) => {\r\n\r\n    return (\r\n        <div className='contact contact-chat'>\r\n            <div className=\"goBack\" onClick={backClick}></div>\r\n            <VisualAvatar size={0.8}/>\r\n\r\n            <div className='contactBody'>\r\n                <div className='status'>\r\n                    <span className=\"nickname\">{nickname}</span>\r\n                    <span className={`connectionStatus ${online ? 'online':'offline' }`}>{online ? 'Online' : 'Offline'}</span>\r\n                </div>\r\n            </div>\r\n            {/*<button className={classes.options}>...</button>*/}\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default FriendHeader;","import React, {useRef, useEffect} from 'react';\r\nimport {useRecoilValue, useRecoilState, useSetRecoilState} from 'recoil';\r\nimport {idiomaState, chatConversation, loginData, view} from '../recoil/atoms';\r\nimport text from './idioma.json';\r\nimport Message from './message';\r\nimport socket from '../socket';\r\nimport FriendHeader from './friendHeader/friendHeader';\r\n\r\nconst Chat = props => {\r\n\r\n    const idioma = useRecoilValue(idiomaState);\r\n    const loginDataUser = useRecoilValue(loginData);\r\n    const [conversation, setConvertation] = useRecoilState(chatConversation);\r\n    const refAreaTexto = useRef('');\r\n    const setView = useSetRecoilState(view.getAtom);\r\n\r\n    const client = socket.getSocket();\r\n    \r\n    const sendMsg = () => {\r\n        \r\n        const oldtext = refAreaTexto.current.innerText;\r\n        const text = oldtext.replace(/^(\\s*\\r*)(.)(\\s*\\r*)$/, '$2');\r\n        if(text !== ''){\r\n            const newStateObj = {...conversation};\r\n            newStateObj[newStateObj.active] = {...newStateObj[conversation.active]};\r\n            newStateObj[newStateObj.active].text = [...newStateObj[newStateObj.active].text, {myMsg: true, msg: text}];\r\n            setConvertation(newStateObj);\r\n            client.emit('message', {from: loginDataUser.socketId, toUserId: conversation.active, toSocketId: conversation[conversation.active].socketId, msg: text});\r\n            refAreaTexto.current.innerText = '';\r\n            refAreaTexto.current.focus();\r\n        }\r\n        \r\n    };\r\n\r\n    useEffect(() => {\r\n        var element = document.getElementById('chatConversation');\r\n        if(element)\r\n            element.scrollTop = element.scrollHeight;\r\n    });\r\n\r\n    \r\n\r\n    const goBack = () => {\r\n        setView(view.posibleViews.CONTACTS);\r\n        setConvertation({...conversation, active: null});\r\n    }\r\n\r\n    const keyPress = (event) => {\r\n        if(conversation.activeOnline){\r\n            if(event.charCode === 13){\r\n                sendMsg();\r\n                \r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n    return (\r\n        <div id=\"chatContainer\">\r\n            <FriendHeader backClick={goBack} nickname={conversation[conversation.active].nickname} online={conversation.activeOnline}/>\r\n            \r\n            <div id=\"chatConversation\">\r\n                {conversation[conversation.active].text.map((elem, idx, arr) => {\r\n                    const style = {};\r\n\r\n                    if(arr[idx + 1] && elem.myMsg === arr[idx+1].myMsg){\r\n                        style.marginBottom = '-3px';\r\n                        style.borderRadius = elem.myMsg ? \"10px 0px 10px 10px\" : \"0 10px 10px 10px\";\r\n                    }\r\n                    if(idx > 0 && elem.myMsg === arr[idx-1].myMsg){\r\n                        style.borderRadius = elem.myMsg ? \"10px 10px 10px 10px\" : \"10px 10px 10px 10px\";\r\n                    }\r\n                    \r\n                    return <Message {...elem} key={idx} style={style}/>\r\n                })}\r\n            </div>\r\n\r\n            <div id=\"editor\"> \r\n                <div id=\"textarea\" role=\"textbox\" contentEditable={conversation.activeOnline} ref={refAreaTexto} onKeyPress={keyPress}></div>\r\n                <button id=\"sendButton\" disabled={!conversation.activeOnline} onClick={sendMsg}>{text.btnSend[idioma]}</button>\r\n            </div>\r\n\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Chat;","import React from 'react';\r\nimport {useRecoilState} from 'recoil';\r\nimport {idiomaState} from '../recoil/atoms';\r\n//import classes from './header.module.css';\r\n\r\nconst Header = props => {\r\n    const [idioma, setIdioma] = useRecoilState(idiomaState);\r\n\r\n    const changeIdioma = ({target: {value}}) => {\r\n        setIdioma(value);\r\n    }\r\n\r\n    return (\r\n        <div className='headerdiv'>\r\n            <div className='infoapp'>\r\n                <div className='apptitle'>Chatapp</div>\r\n            </div>\r\n            \r\n            <select value={idioma} onChange={changeIdioma} className='idiomaselect'>\r\n                <option value=\"es\">ES</option>\r\n                <option value=\"en\">EN</option>\r\n            </select>\r\n        </div>\r\n    );\r\n\r\n}\r\nexport default Header;","import React, {useEffect} from 'react';\r\nimport {useRecoilState, useSetRecoilState} from 'recoil';\r\nimport {contactListState, loginData} from '../recoil/atoms';\r\nimport socket from '../socket'\r\n\r\nconst UserSubscriber = props => {\r\n    const [contactList, setContactListState] = useRecoilState(contactListState);    \r\n    const setLoginData = useSetRecoilState(loginData);\r\n    const client = socket.getSocket();\r\n\r\n    useEffect(() => {\r\n\r\n        client.on('new user', data => {\r\n            if(Array.isArray(data)){\r\n                setContactListState(data.filter(socket => socket.socketId !== client.id));\r\n                setLoginData(data.find(socket => socket.socketId === client.id));\r\n            }  \r\n            else\r\n                setContactListState([...contactList, {nick: data.nickname, _id: data._id, socketId: data.socketId}]);\r\n        });\r\n\r\n        return () => client.off('new user');\r\n    }, [contactList]);\r\n\r\n    return (\r\n        <></>\r\n    );\r\n\r\n}\r\nexport default UserSubscriber;","import React, {useEffect} from 'react';\r\nimport {useRecoilState} from 'recoil';\r\nimport {contactListState, chatConversation} from '../recoil/atoms';\r\nimport socket from '../socket'\r\n\r\nconst UserSubscriber = props => {\r\n    const [contactList, setContactListState] = useRecoilState(contactListState);\r\n    const [conversation, setConversation] = useRecoilState(chatConversation);\r\n    const client = socket.getSocket();\r\n\r\n    useEffect(() => {\r\n        \r\n        client.on('user disconnect', data => {\r\n            setContactListState(contactList.filter(contact => contact.socketId !== data.socketId));\r\n            if(conversation.active === data.socketId){\r\n                setConversation({...conversation, activeOnline: false});\r\n            }\r\n        });\r\n\r\n        return () => client.off('user disconnect');\r\n    }, [conversation]);\r\n\r\n    return (\r\n        <></>\r\n    );\r\n\r\n}\r\nexport default UserSubscriber;","import React, {useEffect} from 'react';\r\nimport {useRecoilState} from 'recoil';\r\nimport {chatConversation} from '../recoil/atoms';\r\nimport socket from '../socket'\r\nconst IncomingMsgSubscriber = props => {\r\n\r\n    const [conversation, setConvertation] = useRecoilState(chatConversation);\r\n    const client = socket.getSocket();\r\n    \r\n    useEffect(() => {\r\n\r\n        client.on('message', data => {\r\n            const newStateObj = {...conversation};\r\n            if(conversation[data.socketId]){\r\n                newStateObj[data.socketId] = {...conversation[data.socketId]};\r\n                if(conversation[data.socketId].text){\r\n                    newStateObj[data.socketId].text = [...conversation[data.socketId].text, {myMsg: false, msg: data.msg}];\r\n                    \r\n                    \r\n\r\n                    if(data.socketId !== newStateObj.active){\r\n                        newStateObj[data.socketId].novistos = newStateObj[data.socketId].novistos + 1; \r\n                    }\r\n                }else{\r\n                    newStateObj[data.socketId].text = [];\r\n                }\r\n                \r\n            }else{\r\n                newStateObj[data.socketId] = {\r\n                    text: [{myMsg: false, msg: data.msg}],\r\n                    nickname: null,\r\n                    socketId: null,\r\n                    novistos: 1\r\n                }\r\n            }\r\n            setConvertation(newStateObj);\r\n        });\r\n\r\n        return () => client.off('message');\r\n    }, [conversation]);\r\n\r\n    return (\r\n        <></>\r\n    );\r\n\r\n}\r\nexport default IncomingMsgSubscriber;","import React from 'react';\r\nimport {useRecoilValue} from 'recoil';\r\nimport {backdropState} from '../recoil/atoms';\r\n\r\nconst Backdrop = props => {\r\n\r\n    const useBackdrop = useRecoilValue(backdropState);\r\n    \r\n    if(useBackdrop){\r\n        console.log(`se muestra backdrop ${useBackdrop}`)\r\n        return <div className=\"backdrop\">\r\n            <div class=\"loader\">Loading...</div>\r\n        </div>;\r\n    }else{\r\n        return null;\r\n    }\r\n/*\r\n    const cmpBody = useBackdrop ? <div className=\"backdrop\"></div> : <></>;\r\n\r\n    return (\r\n        {cmpBody}\r\n    );*/\r\n\r\n}\r\nexport default Backdrop;","import React from 'react';\r\nimport {useRecoilValue} from 'recoil';\r\nimport {view, subscribeToEventsState} from './components/recoil/atoms';\r\nimport Login from './components/login/login';\r\nimport Contacts from './components/contacts/contacts';\r\nimport Chat from './components/chat/chat';\r\n//import Chat from './components/chat/chat';\r\nimport Header from './components/header/header';\r\nimport NewUserSubscriber from './components/events/newUserSubscriber';\r\nimport UserDisconnectSubscriber from './components/events/userDisconnectSubscriber';\r\nimport IncomingMsgSubscriber from './components/events/incomingMsgSubscriber';\r\nimport './App.css';\r\nimport Backdrop from './components/backdrop/backdrop';\r\n\r\n\r\nfunction App() {\r\n  const viewState = useRecoilValue(view.getAtom);\r\n  const subscribe = useRecoilValue(subscribeToEventsState);\r\n  const cmp = viewState === view.posibleViews.LOGIN ? <Login /> : viewState === view.posibleViews.CONTACTS ? <Contacts /> : <Chat />;\r\n\r\n  let subscriptions = null;\r\n  if(subscribe){\r\n    subscriptions = <>\r\n      <NewUserSubscriber />\r\n      <UserDisconnectSubscriber />\r\n      {<IncomingMsgSubscriber />}\r\n    </>\r\n  }\r\n\r\n  return (<><Backdrop />\r\n      <div className=\"main\">\r\n      \r\n        <Header />        \r\n        {cmp}\r\n        {subscriptions}\r\n        \r\n      </div></>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {RecoilRoot} from 'recoil';\n\nReactDOM.render(\n  <React.StrictMode>\n    <RecoilRoot>\n      <App />\n    </RecoilRoot>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}