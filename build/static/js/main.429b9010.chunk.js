(this.webpackJsonpchat_front=this.webpackJsonpchat_front||[]).push([[3],{120:function(e,t,a){"use strict";var n=a(4),r=(a(16),a(8)),o=a(0),c=a(17);t.a=function(){var e=Object(n.useSetRecoilState)(r.i),t=Object(n.useSetRecoilState)(r.l),a=Object(n.useSetRecoilState)(r.j),i=Object(n.useSetRecoilState)(r.d),s=Object(n.useSetRecoilState)(r.f),l=c.a.getSocket();return Object(o.useCallback)((function(){t(null),i([]),s([]),l.emit("logout",{}),localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("refresh_token_expires"),localStorage.removeItem("token_expires"),a(!1),e(null)}))}},14:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n={server:location.origin}},17:function(e,t,a){"use strict";var n,r=a(158),o=a.n(r),c=a(14),i={getSocket:function(){return n||(n=o()(c.a.server))},close:function(){n.close()}};t.a=i},176:function(e,t,a){e.exports=a(256)},181:function(e,t,a){},21:function(e){e.exports=JSON.parse('{"disconnected":{"es":"se ha desconectado","en":"has disconnected"},"connected":{"es":"se ha conectado","en":"has connected"},"accept":{"es":"te ha aceptado","en":"has accepted you"},"decline":{"es":"te ha rechazado","en":"has declined you"},"delete":{"es":"te ha eliminado","en":"has deleted you"},"block":{"es":"te he bloqueado","en":"has bloqued you"},"errorLoadingFriends":{"es":"Error al cargar contactos","en":"Error while loading contacts"},"requestedInv":{"es":"solicita ser su amigo","en":"request be your friend"},"declinedInv":{"es":"ha cancelado la solicitud de amistad","en":"cancel the friend request"},"writingYou":{"es":"ha escrito","en":"has whritten"}}')},23:function(e,t,a){"use strict";a.d(t,"d",(function(){return u})),a.d(t,"e",(function(){return d})),a.d(t,"a",(function(){return m})),a.d(t,"c",(function(){return f})),a.d(t,"b",(function(){return b}));var n=a(50),r=a.n(n),o=a(6),c=a(88),i=a(63),s=a(4),l=a(8),u=Object(s.selector)({key:"friendSelector",get:function(e){var t=e.get;return t(l.f).length>0?Object(i.a)(t(l.f)).sort((function(e,t){if(1===e.friendShipStatus&&1===t.friendShipStatus){if(e.socketId&&!t.socketId)return-1;if(!e.socketId&&t.socketId)return 1}return e.friendShipStatus<t.friendShipStatus?-1:e.friendShipStatus>t.friendShipStatus?1:e.email<t.email?-1:e.email>t.email?1:void 0})):[]},set:function(){var e=Object(c.a)(r.a.mark((function e(t,a){var n,c,s,u,d,m,f,b,p,g,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.set,c=t.get,s=a.action,u=a.payload,e.t0=s,e.next="initialize"===e.t0?5:"add"===e.t0?7:"update"===e.t0?9:"reset_cant_no_leidos"===e.t0?11:"set_message_info"===e.t0?13:"delete"===e.t0?15:"connect"===e.t0?17:"disconnect"===e.t0?19:24;break;case 5:return n(l.f,(function(e){return 0===e.length?u.friends:e})),e.abrupt("break",25);case 7:return n(l.f,(function(e){var t=Object(i.a)(e);return t.push(u.friend),t})),e.abrupt("break",25);case 9:return n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===u.friend.contactId}));return e.slice(0,t).concat([u.friend]).concat(e.slice(t+1))})),e.abrupt("break",25);case 11:return n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===u.contactId}));return e.slice(0,t).concat([Object(o.a)(Object(o.a)({},e[t]),{},{unread:0})]).concat(e.slice(t+1))})),e.abrupt("break",25);case 13:return n(l.f,(function(e){var t=u.dataObj;return e.map((function(e){if(t[e.contactId]){var a=0;return e.unread&&(a=e.unread),t[e.contactId].cantidad&&(a+=t[e.contactId].cantidad),Object(o.a)(Object(o.a)({},e),{},{unread:a,lastMsg:t[e.contactId].lastMessage,datetime:t[e.contactId].datetime})}return e}))})),e.abrupt("break",25);case 15:return n(l.f,(function(e){return e.filter((function(e){return e.contactId!==u.friendId}))})),e.abrupt("break",25);case 17:return Array.isArray(u.data)?n(l.f,(function(e){return e.map((function(e){var t=u.data.findIndex((function(t){return t.userId===e.contactId}));return t>=0?Object(o.a)(Object(o.a)({},e),{},{socketId:u.data[t].socketId}):Object(o.a)({},e)}))})):(d=u.data,m=d.userId,f=d.socketId,b=null,p=0,n(l.f,(function(e){var t=e.findIndex((function(e){return e.contactId===m}));if(t>=0){b=e[t].nickname,p=e[t].friendShipStatus;var a=Object(o.a)(Object(o.a)({},e[t]),{},{socketId:f});return e.slice(0,t).concat([a]).concat(e.slice(t+1))}return e})),b&&1===p&&u.notification("".concat(b," ").concat(u.msg[c(l.h)]),{variant:"info"})),e.abrupt("break",25);case 19:return g=null,v=0,n(l.f,(function(e){var t=e.findIndex((function(e){return e.socketId===u.socketId}));return t>=0?(g=e[t].nickname,v=e[t].friendShipStatus,Object(i.a)(e).slice(0,t).concat([Object(o.a)(Object(o.a)({},e[t]),{},{socketId:null})]).concat(e.slice(t+1))):e})),g&&1===v&&u.notification("".concat(g," ").concat(u.msg[c(l.h)]),{variant:"warning"}),e.abrupt("break",25);case 24:return e.abrupt("break",25);case 25:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}),d=Object(s.selector)({key:"conversationSelector",set:function(e,t){var a=e.set,n=t.contactId,r=t.conversation,o=function(e,t,a,n){return e===a?0:t===a?n?3:2:void 0};a(Object(l.g)(n),(function(e){return r.map((function(e){return{_id:e._id,content:e.content,datetime:e.datetime,state:o(e.userOrigin,e.userDestiny,n,e.readed)}}))}))}}),m=Object(s.selector)({key:"addMessageToConversation",set:function(e,t){var a=e.set,n=t.contactId,r={_id:t.messageId,content:t.content,datetime:t.datetime,state:t.state};a(Object(l.g)(n),(function(e){return e.concat([r])}))}}),f=Object(s.selector)({key:"editMsgToStateSavedSelector",set:function(e,t){var a=e.set,n=t.contactId,r=t.messageId,c=t.datetime,i=t.consecutive;a(Object(l.g)(n),(function(e){var t=e.findIndex((function(e){return e._id===i&&1===e.state}));if(t>=0){var a=Object(o.a)(Object(o.a)({},e[t]),{},{state:2,_id:r,datetime:c});return e.slice(0,t).concat([a]).concat(e.slice(t+1))}return e}))}}),b=Object(s.selector)({key:"editAllMsgToSavedSelector",set:function(e,t){var a=e.set,n=t.contactId;a(Object(l.g)(n),(function(e){return e.map((function(e){return 0!==e.state?Object(o.a)(Object(o.a)({},e),{},{state:3}):e}))}))}})},24:function(e,t,a){"use strict";var n=a(6),r=a(15),o=(a(0),a(4)),c=a(85);t.a=function(){var e=Object(o.useRecoilState)(c.a),t=Object(r.a)(e,2),a=t[0],i=t[1],s=Object(n.a)(Object(n.a)({},a),{},{open:!0,autoHideDuration:3e3}),l=function(e,t){i(Object(n.a)(Object(n.a)({},s),{},{severity:e,msg:t}))};return{openNotification:function(e){i(Object(n.a)(Object(n.a)({},s),e))},openSuccessNotification:function(e){l("success",e)},openErrorNotification:function(e){l("error",e)},openInfoNotification:function(e){l("info",e)},openWarningNotification:function(e){l("warning",e)}}}},252:function(e,t){},256:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(12),c=a.n(o),i=(a(181),a(4)),s=a(8),l=a(18),u=a(159),d=a(296),m=a(315),f=a(259),b=a(314),p=a(310),g=a(260),v=a(154),h=a.n(v),O=a(25),j=a(15),k=a(16),E=a.n(k),S=a(322),I=a(308),y=a(318),w=a(311),x=a(319),C=a(313),N=a(312),R=a(59),_=a.n(R),F=a(94),T=a(309),W=a(39),q=a(6),D=a(24),P=a(40),A=a(297),V=a(299),z=a(300),M=a(301),L=a(307),B=function(e){var t=e.idioma,a=e.forgetPassHandler,n=e.forgotWinState,o=e.forgotWinOk,c=e.onChangeForgotEmail,i=e.forgotEmailState;return r.a.createElement(A.a,{open:n,onClose:a,"aria-labelledby":"form-dialog-title"},r.a.createElement(V.a,{id:"form-dialog-title"},P.title[t]),r.a.createElement(z.a,null,r.a.createElement(M.a,null,P.forgotText[t]),r.a.createElement(y.a,{autoFocus:!0,margin:"dense",id:"name",label:P.email[t],type:"email",fullWidth:!0,onChange:c,value:i.value,helperText:i.valid?"":P.invalidEmail[t],error:!i.valid})),r.a.createElement(L.a,null,r.a.createElement(I.a,{onClick:a,color:"primary"},P.forgotBtnCancel[t]),r.a.createElement(I.a,{onClick:o,color:"primary"},P.forgotBtnOk[t])))},H=a(14),J=function(e){var t=e.idioma,a=e.forgotWinState,o=e.forgetPassHandler,c=Object(n.useState)({value:"",valid:!0}),i=Object(j.a)(c,2),s=i[0],l=i[1],u=Object(D.a)(),d=u.openSuccessNotification,m=u.openErrorNotification;return r.a.createElement(B,{idioma:t,forgotWinState:a,onChangeForgotEmail:function(e){var t=e.target.value;l(Object(q.a)(Object(q.a)({},s),{},{valid:!0,value:t}))},forgotWinOk:function(){/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(s.value)?E.a.post("".concat(H.a.server,"/users/forgot"),{email:s.value,hostname:window.location.host}).then((function(e){201===e.status&&d(P.emailSended[t]),o()})).catch((function(e){404===e.response.status?m(P.emailNotFound[t]):m(P.error[t])})):l(Object(q.a)(Object(q.a)({},s),{},{valid:!1}))},forgotEmailState:s,setForgotEmailStste:l,forgetPassHandler:o})},U=function(e){return r.a.createElement(J,e)},Y=a(41),$=Object(d.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)},link:{cursor:"pointer",textDecoration:"none",color:e.palette.text.secondary,"&:hover":{textDecoration:"underline"}}}}));function G(e){var t=e.idioma,a=e.emailRef,n=e.passRef,o=e.onSignIn,c=e.rememberChecked,i=e.onRememberChange,s=e.forgetPassHandler,l=e.forgotWinState,u=$();return r.a.createElement(T.a,{component:"main",maxWidth:"xs"},r.a.createElement(p.a,null),r.a.createElement("div",{className:u.paper},r.a.createElement(S.a,{className:u.avatar},r.a.createElement(_.a,null)),r.a.createElement(F.a,{component:"h1",variant:"h5"},Y.signin[t]),r.a.createElement("form",{className:u.form,noValidate:!0},r.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:Y.email[t],name:"email",autoComplete:"email",autoFocus:!0,inputRef:a}),r.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:Y.password[t],type:"password",id:"password",autoComplete:"current-password",inputRef:n}),r.a.createElement(w.a,{control:r.a.createElement(x.a,{value:"remember",color:"primary",checked:c,onChange:i}),label:Y.rememberme[t]}),r.a.createElement(I.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:u.submit,onClick:o},Y.signin[t]),r.a.createElement(N.a,{container:!0},r.a.createElement(N.a,{item:!0,xs:!0},r.a.createElement(C.a,{className:u.link,onClick:s},Y.forgotpassword[t])),r.a.createElement(N.a,{item:!0},r.a.createElement(W.b,{to:"/signup",className:u.link},Y.gosignup[t]))))),r.a.createElement(U,{idioma:t,forgotWinState:l,forgetPassHandler:s}))}var Z=a(34),K=function(e){var t=Object(i.useRecoilState)(s.h),a=Object(j.a)(t,2),o=a[0],c=a[1],u=Object(i.useSetRecoilState)(s.l),d=Object(i.useSetRecoilState)(s.k),m=Object(i.useSetRecoilState)(s.i),f=Object(n.useState)(null),b=Object(j.a)(f,2),p=b[0],g=b[1],v=Object(D.a)().openErrorNotification,h=Object(n.useRef)(""),O=Object(n.useRef)(""),k=Object(n.useState)(!1),S=Object(j.a)(k,2),I=S[0],y=S[1],w=Object(n.useState)(!1),x=Object(j.a)(w,2),C=x[0],N=x[1];Object(n.useEffect)((function(){Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/loginWithToken"),{token:e}).then((function(e){if(200===e.status){var t=e.data,a=t.token,n=t.token_expires,r=t._id,o=t.nickname,i=t.firstName,s=t.lastName,l=t.email,f=t.gender,b=t.language,p=t.avatarUrl;localStorage.setItem("token",a),localStorage.setItem("token_expires",n),d({timeleft:n}),m({userId:r,nickname:o,firstName:i,lastName:s,email:l,gender:f}),c(b),u("".concat(H.a.server).concat(p)),g(!0)}})).catch((function(e){console.log("Error al cargar los datos del usuario usando el token")}))})),localStorage.email&&localStorage.password&&localStorage.rememberme&&(h.current.value=localStorage.email,O.current.value=localStorage.password,y(!0))}),[]);return p?r.a.createElement(l.a,{to:"/contacts"}):r.a.createElement(G,{idioma:o,emailRef:h,passRef:O,rememberChecked:I,onRememberChange:function(e){return y(e.target.checked)},onSignIn:function(e){e.preventDefault(),!0===I?(localStorage.setItem("email",h.current.value),localStorage.setItem("password",O.current.value),localStorage.setItem("rememberme",!0)):(localStorage.removeItem("email"),localStorage.removeItem("password"),localStorage.removeItem("rememberme")),E.a.post("".concat(H.a.server,"/users/login"),{email:h.current.value,password:O.current.value}).then((function(e){if(200===e.status){var t=e.data,a=t.token,n=t.token_expires,r=t._id,o=t.nickname,i=t.firstName,s=t.lastName,l=t.email,f=t.gender,b=t.language,p=t.avatarUrl,v=t.refresh_token,h=t.refresh_token_expires;localStorage.setItem("token",a),localStorage.setItem("refresh_token",v),localStorage.setItem("token_expires",n),localStorage.setItem("refresh_token_expires",h),d({timeleft:n}),m({userId:r,nickname:o,firstName:i,lastName:s,email:l,gender:f}),c(b),u("".concat(H.a.server).concat(p)),g(!0)}})).catch((function(e){403===e.response.status?v(Y.notAuthorized[o]):v(Y.internalError[o])}))},forgotWinState:C,forgetPassHandler:function(){N(!C)}})},Q=function(e){return r.a.createElement(K,null)},X=Object(d.a)((function(e){return{container:{padding:0,position:"relative",height:"100vh",overflowY:"hidden",backgroundColor:e.palette.background.paper}}})),ee=function(e){var t=X();return r.a.createElement(T.a,{maxWidth:"sm",className:t.container,component:"main"},r.a.createElement(p.a,null),e.children)},te=function(e){return r.a.createElement(ee,e)},ae=a(30),ne=Object(d.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(3)},submit:{margin:e.spacing(3,0,2)},link:{cursor:"pointer",textDecoration:"none",color:e.palette.text.secondary,"&:hover":{textDecoration:"underline"}}}}));function re(e){var t=e.idioma,a=e.onSignUp,n=e.emailState,o=e.onEmailChange,c=e.passState,i=e.onPassChange,s=e.nameState,l=e.onNameChange,u=e.lastNameRef,d=ne();return r.a.createElement(T.a,{component:"main",maxWidth:"xs"},r.a.createElement(p.a,null),r.a.createElement("div",{className:d.paper},r.a.createElement(S.a,{className:d.avatar},r.a.createElement(_.a,null)),r.a.createElement(F.a,{component:"h1",variant:"h5"},ae.signup[t]),r.a.createElement("form",{className:d.form,noValidate:!0},r.a.createElement(N.a,{container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{autoComplete:"fname",name:"firstName",variant:"outlined",required:!0,fullWidth:!0,id:"firstName",label:ae.firstName[t],autoFocus:!0,value:s.value,helperText:s.valid?"":ae[s.msg][t],error:!s.valid,onChange:l})),r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(y.a,{variant:"outlined",fullWidth:!0,id:"lastName",label:ae.lastName[t],name:"lastName",autoComplete:"lname",inputRef:u})),r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"outlined",required:!0,fullWidth:!0,id:"email",label:ae.email[t],name:"email",autoComplete:"email",value:n.value,helperText:n.valid?"":ae.invalidEmail[t],error:!n.valid,onChange:o})),r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement(y.a,{variant:"outlined",required:!0,fullWidth:!0,name:"password",label:ae.password[t],type:"password",id:"password",autoComplete:"current-password",value:c.value,helperText:c.valid?"":ae[c.msg][t],error:!c.valid,onChange:i}))),r.a.createElement(I.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:d.submit,onClick:a},ae.signup[t]),r.a.createElement(N.a,{container:!0,justify:"flex-end"},r.a.createElement(N.a,{item:!0},r.a.createElement(W.b,{to:"/",className:d.link},ae.signin[t]))))))}var oe=function(e){var t=Object(i.useRecoilValue)(s.h),a=Object(D.a)(),o=a.openSuccessNotification,c=a.openErrorNotification,l=Object(n.useState)({value:"",valid:!0}),u=Object(j.a)(l,2),d=u[0],m=u[1],f=Object(n.useState)({value:"",valid:!0}),b=Object(j.a)(f,2),p=b[0],g=b[1],v=Object(n.useState)({value:"",valid:!0}),h=Object(j.a)(v,2),O=h[0],k=h[1],S=Object(n.useRef)();return r.a.createElement(re,{idioma:t,lastNameRef:S,nameState:O,passState:p,emailState:d,onSignUp:function(e){e.preventDefault(),/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(d.value)?p.value.length<8?g(Object(q.a)(Object(q.a)({},p),{},{valid:!1,msg:"passShort"})):/^[a-zA-Z\']+$/.test(O.value)?O.value.length<2?k(Object(q.a)(Object(q.a)({},O),{},{valid:!1,msg:"nameShort"})):O.value.length>=20?k(Object(q.a)(Object(q.a)({},O),{},{valid:!1,msg:"nameLong"})):E.a.post("".concat(H.a.server,"/users/signup"),{firstName:O.value,lastName:S.current.value,email:d.value,password:p.value,language:t,hostname:window.location.host}).then((function(e){201===e.status&&o(ae.userCreated[t])})).catch((function(e){409===e.response.status?c(ae.duplicated[t]):c(ae.error[t])})):k(Object(q.a)(Object(q.a)({},O),{},{valid:!1,msg:"nameInvalid"})):m(Object(q.a)(Object(q.a)({},d),{},{valid:!1}))},onNameChange:function(e){var t=e.target.value;k(Object(q.a)(Object(q.a)({},O),{},{value:t,valid:!0}))},onEmailChange:function(e){var t=e.target.value;m(Object(q.a)(Object(q.a)({},d),{},{value:t,valid:!0}))},onPassChange:function(e){var t=e.target.value;g(Object(q.a)(Object(q.a)({},p),{},{value:t,valid:!0}))}})},ce=function(e){return r.a.createElement(oe,null)},ie=a(320),se=a(316),le=a(85);function ue(e){return r.a.createElement(se.a,Object.assign({elevation:6,variant:"filled"},e))}var de=function(){var e=Object(i.useRecoilState)(le.a),t=Object(j.a)(e,2),a=t[0],n=t[1],o=function(e,t){"clickaway"!==t&&n(Object(q.a)(Object(q.a)({},a),{},{open:!1}))};return r.a.createElement(ie.a,{open:a.open,autoHideDuration:a.autoHideDuration,onClose:o,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(ue,{onClose:o,severity:a.severity},a.msg))},me=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(de,null))},fe=a(42),be=Object(d.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}}));function pe(e){var t=e.idioma,a=e.passState,n=e.pass2State,o=e.onPassChange,c=e.onPass2Change,i=e.submitPass,s=be();return r.a.createElement(T.a,{component:"main",maxWidth:"xs"},r.a.createElement("div",{className:s.paper},r.a.createElement(S.a,{className:s.avatar},r.a.createElement(_.a,null)),r.a.createElement(F.a,{component:"h1",variant:"h5"},fe.title[t]),r.a.createElement("form",{className:s.form,noValidate:!0},r.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:fe.password[t],type:"password",id:"password",autoComplete:"current-password",value:a.value,onChange:o,helperText:a.valid?"":fe.invalidPass[t],error:!a.valid}),r.a.createElement(y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:fe.repeatPassword[t],type:"password",id:"password",autoComplete:"current-password",value:n.value,onChange:c,helperText:n.valid?"":fe.passNotEqual[t],error:!n.valid}),r.a.createElement(I.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:s.submit,onClick:i},fe.changePass[t]),r.a.createElement(N.a,{container:!0,justify:"flex-end"},r.a.createElement(N.a,{item:!0},r.a.createElement(W.b,{to:"/"},fe.signin[t]))))))}var ge=Object(l.g)((function(e){var t=Object(i.useRecoilValue)(s.h),a=Object(D.a)(),o=a.openErrorNotification,c=a.openSuccessNotification,l=Object(n.useState)({value:"",valid:!0}),u=Object(j.a)(l,2),d=u[0],m=u[1],f=Object(n.useState)({value:"",valid:!0}),b=Object(j.a)(f,2),p=b[0],g=b[1];return r.a.createElement(pe,{idioma:t,passState:d,pass2State:p,onPassChange:function(e){var t=e.target.value;m(Object(q.a)(Object(q.a)({},d),{},{value:t,valid:!0})),g(Object(q.a)(Object(q.a)({},p),{},{valid:!0}))},onPass2Change:function(e){var t=e.target.value;g(Object(q.a)(Object(q.a)({},p),{},{value:t,valid:!0}))},submitPass:function(a){if(a.preventDefault(),d.value.length<8)m(Object(q.a)(Object(q.a)({},d),{},{valid:!1}));else if(p.value!==d.value)g(Object(q.a)(Object(q.a)({},p),{},{valid:!1}));else{var n=e.match.params.token;E.a.post("".concat(H.a.server,"/users/resetpassword"),{token:n,password:d.value}).then((function(e){200===e.status&&c(fe.passChangeOk[t])})).catch((function(e){o(fe.passChangeError[t])}))}}})})),ve=function(e){return r.a.createElement(ge,e)},he=a(120),Oe=function(){var e=Object(i.useSetRecoilState)(s.k),t=Object(he.a)();return Object(n.useCallback)((function(){var a=localStorage.getItem("token"),n=localStorage.getItem("refresh_token"),r=localStorage.getItem("refresh_token_expires");if(n&&r&&new Date(r).getTime()>(new Date).getTime())return E.a.post("".concat(H.a.server,"/users/refreshtoken"),{token:a,refresh_token:n}).then((function(t){if(200===t.status){var a=t.data,n=a.new_token,r=a.new_refresh_token,o=a.new_token_expires,c=a.new_refresh_token_expires;localStorage.setItem("token",n),localStorage.setItem("refresh_token",r),localStorage.setItem("token_expires",o),localStorage.setItem("refresh_token_expires",c),e({timeleft:o})}})).catch((function(e){t()}));t()}),[t,e])},je=a(23),ke=a(17),Ee=a(21),Se=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(i.useRecoilValue)(s.i),c=Object(O.b)().enqueueSnackbar;return Object(n.useEffect)((function(){return t.on("new user",(function(e){console.log("new user"),a({action:"connect",payload:{data:e,notification:c,msg:Ee.connected}})})),o&&t.emit("new user",{userId:o.userId}),function(){return t.off("new user")}}),[a,t,o]),r.a.createElement(r.a.Fragment,null)},Ie=function(e){var t=Object(i.useSetRecoilState)(je.d),a=ke.a.getSocket(),o=Object(O.b)().enqueueSnackbar;return Object(n.useEffect)((function(){return a.on("user disconnect",(function(e){t({action:"disconnect",payload:{socketId:e.socketId,notification:o,msg:Ee.disconnected}})})),function(){return a.off("user disconnect")}}),[]),r.a.createElement(r.a.Fragment,null)},ye=a(63),we=function(e){var t=Object(i.useRecoilState)(s.c),a=Object(j.a)(t,2),o=a[0],c=a[1],l=ke.a.getSocket();return Object(n.useEffect)((function(){return l.on("message",(function(e){var t=Object(q.a)({},o);o[e.socketId]?(t[e.socketId]=Object(q.a)({},o[e.socketId]),o[e.socketId].text?(t[e.socketId].text=[].concat(Object(ye.a)(o[e.socketId].text),[{myMsg:!1,msg:e.msg}]),e.socketId!==t.active&&(t[e.socketId].novistos=t[e.socketId].novistos+1)):t[e.socketId].text=[]):t[e.socketId]={text:[{myMsg:!1,msg:e.msg}],nickname:null,socketId:null,novistos:1},c(t)})),function(){return l.off("message")}}),[o]),r.a.createElement(r.a.Fragment,null)},xe=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(O.b)().enqueueSnackbar,c=(Object(i.useRecoilValue)(s.i),Object(i.useRecoilValue)(s.h));Object(D.a)().openErrorNotification;return Object(n.useEffect)((function(){return t.on("declined friendship",(function(e){var t=e.declinerId,n=(e.declinedId,e.socketIdDecliner);e.socketIdDeclined;Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/getFriendById"),{friendId:t},{headers:{Authorization:e}}).then((function(e){if(200===e.status)return a({action:"update",payload:{friend:Object(q.a)(Object(q.a)({},e.data.friend),{},{socketId:n})}}),e.data.friend})).then((function(e){o("".concat(e.nickname," ").concat(Ee.declinedInv[c]),{variant:"warning"})})).catch((function(e){404===e.response.status&&a({action:"delete",payload:{friendId:t}})}))}))})),function(){return t.off("declined friendship")}}),[]),r.a.createElement(r.a.Fragment,null)},Ce=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(O.b)().enqueueSnackbar,c=Object(i.useRecoilValue)(s.i),l=Object(i.useRecoilValue)(s.h),u=Object(D.a)().openErrorNotification;return Object(n.useEffect)((function(){return t.on("requested friendship",(function(e){var t=e.userIdRequester,n=e.userIdRequested,r=e.socketIdRequester;if(n===c.userId){Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/getFriendById"),{friendId:t},{headers:{Authorization:e}}).then((function(e){if(200===e.status)return a({action:"add",payload:{friend:Object(q.a)(Object(q.a)({},e.data.friend),{},{socketId:r})}}),e.data.friend})).then((function(e){o("".concat(e.nickname," ").concat(Ee.requestedInv[l]),{variant:"success"})})).catch((function(e){u(Ee.errorLoadingFriends[l])}))}))}})),function(){return t.off("requested friendship")}}),[]),r.a.createElement(r.a.Fragment,null)},Ne=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(O.b)().enqueueSnackbar,c=(Object(i.useRecoilValue)(s.i),Object(i.useRecoilValue)(s.h)),l=Object(D.a)().openErrorNotification;return Object(n.useEffect)((function(){return t.on("accepted friendship",(function(e){var t=e.accepterId,n=e.socketIdAccepter;Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/getFriendById"),{friendId:t},{headers:{Authorization:e}}).then((function(e){if(200===e.status)return a({action:"update",payload:{friend:Object(q.a)(Object(q.a)({},e.data.friend),{},{socketId:n})}}),e.data.friend})).then((function(e){o("".concat(e.nickname," ").concat(Ee.accept[c]),{variant:"success"})})).catch((function(e){l(Ee.errorLoadingFriends[c])}))}))})),function(){return t.off("accepted friendship")}}),[]),r.a.createElement(r.a.Fragment,null)},Re=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(O.b)().enqueueSnackbar,c=Object(i.useRecoilValue)(s.h),l=Object(D.a)().openErrorNotification;return Object(n.useEffect)((function(){return t.on("deleted contact",(function(e){var t=e.deleterId,n=e.socketIdDeleter;Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/getFriendById"),{friendId:t},{headers:{Authorization:e}}).then((function(e){if(200===e.status)return a({action:"update",payload:{friend:Object(q.a)(Object(q.a)({},e.data.friend),{},{socketId:n})}}),e.data.friend})).then((function(e){o("".concat(e.nickname," ").concat(Ee.delete[c]),{variant:"error"})})).catch((function(e){l(Ee.errorLoadingFriends[c])}))}))})),function(){return t.off("deleted contact")}}),[]),r.a.createElement(r.a.Fragment,null)},_e=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.d),o=Object(O.b)().enqueueSnackbar,c=Object(i.useRecoilValue)(s.h),l=Object(D.a)().openErrorNotification;return Object(n.useEffect)((function(){return t.on("blocked contact",(function(e){var t=e.blokerId,n=e.socketIdBloked;Object(Z.a)((function(e){E.a.post("".concat(H.a.server,"/users/getFriendById"),{friendId:t},{headers:{Authorization:e}}).then((function(e){if(200===e.status)return a({action:"update",payload:{friend:Object(q.a)(Object(q.a)({},e.data.friend),{},{socketId:n})}}),e.data.friend})).then((function(e){o("".concat(e.nickname," ").concat(Ee.block[c]),{variant:"error"})})).catch((function(e){l(Ee.errorLoadingFriends[c])}))}))})),function(){return t.off("bloked contact")}}),[]),r.a.createElement(r.a.Fragment,null)},Fe=a(65),Te=function(e){var t=ke.a.getSocket(),a=Object(i.useSetRecoilState)(je.a),o=Object(i.useSetRecoilState)(je.c),c=Object(i.useSetRecoilState)(je.b),l=Object(i.useRecoilValue)(s.i),u=Object(i.useRecoilValue)(s.a),d=Object(O.b)().enqueueSnackbar,m=Object(i.useRecoilState)(je.d),f=Object(j.a)(m,2),b=f[0],p=f[1],g=Object(i.useRecoilValue)(s.h);return Object(n.useEffect)((function(){return t.on("recived message",(function(e){var t=e.content,n=e.userOriginId,r=(e.socketIdSender,e.messageId),o=e.datetime,c=(e.consecutive,b.find((function(e){return e.contactId===n})));if(u!==n){d("".concat(c.nickname," ").concat(Ee.writingYou[g]),{variant:"info"});var i=Object(Fe.a)({},n,{cantidad:1,lastMessage:t,datetime:o});p({action:"set_message_info",payload:{dataObj:i}})}else{var s=Object(Fe.a)({},n,{cantidad:0,lastMessage:t,datetime:o});p({action:"set_message_info",payload:{dataObj:s}}),ke.a.getSocket().emit("read messages",{userId:l.userId,contactId:c.contactId,notifyTo:c.socketId,token:localStorage.getItem("token")})}a({contactId:n,messageId:r,content:t,datetime:o,state:0})})),t.on("saved message",(function(e){var t=e.contactId,a=e.messageId,n=e.datetime,r=e.consecutive;e.soketIdContact;o({contactId:t,messageId:a,datetime:n,consecutive:r})})),t.on("readed messages",(function(e){var t=e.contactId;c({contactId:t})})),function(){t.off("recived message"),t.off("saved message"),t.off("readed messages")}})),r.a.createElement(r.a.Fragment,null)},We=r.a.lazy((function(){return Promise.all([a.e(0),a.e(2),a.e(6),a.e(10)]).then(a.bind(null,430))})),qe=r.a.lazy((function(){return Promise.all([a.e(0),a.e(8),a.e(12)]).then(a.bind(null,434))})),De=r.a.lazy((function(){return Promise.all([a.e(0),a.e(1),a.e(7)]).then(a.bind(null,431))})),Pe=r.a.lazy((function(){return Promise.all([a.e(1),a.e(9)]).then(a.bind(null,433))})),Ae=r.a.lazy((function(){return Promise.all([a.e(2),a.e(11),a.e(13)]).then(a.bind(null,437))})),Ve=function(){var e=Oe(),t=Object(i.useRecoilValue)(s.k);return r.a.useEffect((function(){var a=new Date(t.timeleft).getTime()-(new Date).getTime();a>=1e4&&setTimeout((function(){e()}),a-1e4)}),[t]),r.a.createElement(r.a.Fragment,null)},ze=Object(u.a)({palette:{type:"dark"}}),Me=Object(u.a)({}),Le=Object(d.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}})),Be=function(){var e=Le(),t=Object(i.useRecoilValue)(s.e),a=Object(i.useRecoilValue)(s.j),o=Object(i.useRecoilValue)(s.i),c=Object(i.useRecoilValue)(s.a),u=r.a.createRef(),d=function(e){return function(){u.current.closeSnackbar(e)}},v=null!==o?r.a.createElement(r.a.Fragment,null,c?r.a.createElement(n.Suspense,{fallback:r.a.createElement(f.a,{className:e.backdrop,open:!0},r.a.createElement(b.a,{color:"inherit"}))},r.a.createElement(Pe,null)):r.a.createElement(l.b,{path:"/contacts",exact:!0,render:function(){return r.a.createElement(m.a,{theme:t?ze:Me},r.a.createElement(n.Suspense,{fallback:r.a.createElement(f.a,{className:e.backdrop,open:!0},r.a.createElement(b.a,{color:"inherit"}))},r.a.createElement(We,null),r.a.createElement(qe,null),r.a.createElement(De,null)))}})):null;return r.a.createElement(m.a,{theme:t?ze:Me},r.a.createElement(te,null,r.a.createElement(p.a,null),r.a.createElement(me,null),r.a.createElement(O.a,{maxSnack:3,autoHideDuration:3e3,preventDuplicate:!0,anchorOrigin:{vertical:"top",horizontal:"left"},ref:u,action:function(e){return r.a.createElement(g.a,{onClick:d(e)},r.a.createElement(h.a,{fontSize:"small",style:{color:"white"}}))}},r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"/",exact:!0,component:Q}),r.a.createElement(l.b,{path:"/signup",exact:!0,component:ce}),v,r.a.createElement(l.b,{path:"/changepass/:token",exact:!0,component:ve}),r.a.createElement(l.b,{path:"/activateuser/:token/:nickname/:invited",exact:!0,render:function(){return r.a.createElement(n.Suspense,{fallback:r.a.createElement(f.a,{className:e.backdrop,open:!0},r.a.createElement(b.a,{color:"inherit"}))},r.a.createElement(Ae,null))}}),r.a.createElement(l.b,{path:"/activateuser/:token/:nickname",exact:!0,render:function(){return r.a.createElement(n.Suspense,{fallback:r.a.createElement(f.a,{className:e.backdrop,open:!0},r.a.createElement(b.a,{color:"inherit"}))},r.a.createElement(Ae,null))}}),r.a.createElement(l.a,{from:"/",to:"/"})),a?r.a.createElement(r.a.Fragment,null,r.a.createElement(Se,null),r.a.createElement(Ie,null),r.a.createElement(we,null),r.a.createElement(Ce,null),r.a.createElement(xe,null),r.a.createElement(Ne,null),r.a.createElement(Re,null),r.a.createElement(_e,null),r.a.createElement(Te,null)):null,r.a.createElement(Ve,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(255);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(i.RecoilRoot,null,r.a.createElement(W.a,null,r.a.createElement(Be,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},30:function(e){e.exports=JSON.parse('{"signup":{"es":"Crear cuenta","en":"Sign up"},"firstName":{"es":"Nombre","en":"First Name"},"lastName":{"es":"Apellidos","en":"Last Name"},"email":{"es":"Correo Electr\xf3nico","en":"Email Address"},"password":{"es":"Contrase\xf1a","en":"Password"},"signin":{"es":"Ya tienes una cuenta? Reg\xedstrate!","en":"Already have an account? Sign in!"},"invalidEmail":{"es":"Correo inv\xe1lido","en":"Invalid email"},"passShort":{"es":"Debe tener al menos 8 caracteres","en":"Must have at least 8 characters"},"nameInvalid":{"es":"Sin espacios. Sin n\xfameros.","en":"No spaces. No numbers."},"nameShort":{"es":"Muy corto (min 2)","en":"Too Short (2 min)"},"nameLong":{"es":"Muy largo (max 20)","en":"Too long (max 20)"},"duplicated":{"es":"El correo ya se encuentra registrado.","en":"The email is already registered."},"error":{"es":"Error interno","en":"Internal error"},"userCreated":{"es":"Usuario creado. Revise su correo para activarlo.","en":"User created. Check your email to activate it."}}')},34:function(e,t,a){"use strict";var n=a(50),r=a.n(n),o=a(88),c=function(){var e=Object(o.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=localStorage.getItem("token"),n=localStorage.getItem("token_expires"),!(a&&n&&new Date(n).getTime()>(new Date).getTime())){e.next=7;break}return e.next=5,t(a);case 5:return o=e.sent,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t.a=c},40:function(e){e.exports=JSON.parse('{"title":{"en":"Reset password","es":"Cambiar contrase\xf1a"},"email":{"en":"Email Address","es":"Correo Electr\xf3nico"},"forgotText":{"es":"Escriba su correo electr\xf3nico y le enviaremos un enlace para que pueda cambiar su contrase\xf1a.","en":"Write your email, and we send you a link in wish you can change your password."},"forgotBtnOk":{"es":"Continuar","en":"Continue"},"forgotBtnCancel":{"es":"Cancelar","en":"Cancel"},"invalidEmail":{"es":"Correo inv\xe1lido","en":"Invalid email"},"emailSended":{"es":"Revise su bandeja de entrada de correos","en":"Check your email inbox"},"emailNotFound":{"es":"Correo no encontrado","en":"Email not found"},"error":{"es":"Error interno","en":"Internal error"}}')},41:function(e){e.exports=JSON.parse('{"signin":{"es":"Entrar","en":"Sign in"},"email":{"en":"Email Address","es":"Correo Electr\xf3nico"},"password":{"en":"Password","es":"Contrase\xf1a"},"rememberme":{"en":"Remember me","es":"Recu\xe9rdame"},"forgotpassword":{"en":"Forgot password?","es":"Olvid\xf3 su contrase\xf1a?"},"gosignup":{"en":"Dont have an account? Sign Up!","es":"No tienes una cuenta? Cre\xe1tela!"},"notAuthorized":{"en":"Not authorized","es":"No autorizado"},"internalError":{"en":"Internal error","es":"Error interno"}}')},42:function(e){e.exports=JSON.parse('{"title":{"es":"Cambiar contrase\xf1a","en":"Change password"},"password":{"es":"Contrase\xf1a","en":"Password"},"invalidPass":{"es":"Debe tener al menos 8 caracteres","en":"Must have at least 8 characters"},"repeatPassword":{"es":"Repita la contrase\xf1a","en":"Repeat password"},"passNotEqual":{"es":"Las contrase\xf1as no son iguales","en":"The passwords are not equal"},"changePass":{"es":"Cambiar contrase\xf1a","en":"Change password"},"passChangeOk":{"es":"La contrase\xf1a ha sido cambiada","en":"Your password has been changed"},"passChangeError":{"es":"La contrase\xf1a no se pudo cambiar","en":"The password can\'t be changed"},"signin":{"es":"Ir a la p\xe1gina de registro","en":"Go to login page"}}')},8:function(e,t,a){"use strict";a.d(t,"h",(function(){return r})),a.d(t,"i",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return s})),a.d(t,"j",(function(){return l})),a.d(t,"l",(function(){return c})),a.d(t,"b",(function(){return u})),a.d(t,"f",(function(){return d})),a.d(t,"a",(function(){return m})),a.d(t,"g",(function(){return f})),a.d(t,"k",(function(){return b})),a.d(t,"e",(function(){return p}));var n=a(4),r=Object(n.atom)({key:"idiomaState",default:function(){var e="en",t=navigator.language||navigator.userLanguage;return/^(es-).+/.test(t)&&(e="es"),e}()}),o=Object(n.atom)({key:"loginData",default:null}),c=Object(n.atom)({key:"userAvatarState",default:null}),i=Object(n.atom)({key:"chatConversation",default:{active:!1}}),s=Object(n.atom)({key:"contactListState",default:[]}),l=(Object(n.atom)({key:"view",default:"LOGIN"}),Object(n.atom)({key:"backdropState",default:!1}),Object(n.atom)({key:"subscribeToEventsState",default:!1})),u=Object(n.atom)({key:"addContactViewOpenState",default:!1}),d=Object(n.atom)({key:"friendsAtom",default:[]}),m=Object(n.atom)({key:"activeChatWith",default:null}),f=function(e){return Object(n.atom)({key:"conversationWith_".concat(e),default:[]})},b=(Object(n.atom)({key:"messagesAtom",default:null}),Object(n.atom)({key:"tokenTimeoutAtom",default:{tokentimeout:0}})),p=Object(n.atom)({key:"themeAtom",default:"true"===localStorage.getItem("darkMode")})},85:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(4),r=Object(n.atom)({key:"notificationAtom",default:{open:!1,autoHideDuration:6e3,severity:"success",msg:""}})}},[[176,4,5]]]);
//# sourceMappingURL=main.429b9010.chunk.js.map