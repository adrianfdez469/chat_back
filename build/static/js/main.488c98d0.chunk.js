(this.webpackJsonpchat_front=this.webpackJsonpchat_front||[]).push([[0],{128:function(e,t){},131:function(e,t,a){},132:function(e,t,a){"use strict";a.r(t);var n,c=a(0),i=a.n(c),o=a(25),l=a.n(o),s=(a(60),a(1)),r=Object(s.atom)({key:"idiomaState",default:"es"}),u=Object(s.atom)({key:"loginData",default:null}),m=Object(s.atom)({key:"chatConversation",default:{active:!1}}),d=Object(s.atom)({key:"contactListState",default:[]}),v={posibleViews:{LOGIN:"LOGIN",CONTACTS:"CONTACTS",CHAT:"CHAT"},getAtom:Object(s.atom)({key:"view",default:"LOGIN"})},f=Object(s.atom)({key:"backdropState",default:!1}),b=Object(s.atom)({key:"subscribeToEventsState",default:!1}),O=a(2),g=a(14),k=a.n(g),E=a(15),p=a(53),j=a.n(p),h={server:"https://shut-app-back.herokuapp.com"},S={getSocket:function(){return n||(n=j()(h.server))}},x=function(e){var t=Object(s.useRecoilValue)(r),a=Object(s.useSetRecoilState)(u),n=Object(s.useSetRecoilState)(v.getAtom),o=Object(s.useRecoilState)(d),l=Object(O.a)(o,2),m=(l[0],l[1],Object(s.useSetRecoilState)(b)),g=Object(s.useSetRecoilState)(f),p=Object(c.useState)({nickname:"",valid:null}),j=Object(O.a)(p,2),x=j[0],N=j[1],y=function(e){g(!0),k.a.post("".concat(h.server,"/login"),{nickname:e}).then((function(t){if(200===t.status){var a=S.getSocket();return a.emit("new user",{nickname:e,_id:t.data._id}),{client:a,nickname:e,_id:t.data._id}}throw Error("El login no fue satiscactorio")})).then((function(e){a({nickname:e.nickname,_id:e._id,socketId:e.client.id})})).then((function(){m(!0)})).then((function(){n(v.posibleViews.CONTACTS)})).catch((function(e){console.log(e)})).finally((function(){g(!1)}))};return i.a.createElement("div",{className:"login"},i.a.createElement("h2",null,E.welcome[t]),i.a.createElement("input",{type:"text",placeholder:E.placeholder[t],onChange:function(e){var t=e.target.value;/^[a-zA-Z][a-zA-Z0-9]{2,10}$/.test(t)?N({nickname:t,valid:!0}):N({nickname:t,valid:!1})},onKeyPress:function(e){13===e.charCode&&y(x.nickname)},value:x.nickname,className:x.valid?"valid":"invalid"}),x.valid?i.a.createElement("button",{onClick:function(){return y(x.nickname)}},E.txtBtn[t]):null)},N=a(5),y=a(3),_=function(e){var t=e.size,a=void 0===t?1:t,n=e.novistos,c=void 0===n?0:n,o={width:"".concat(50*a,"px"),height:"".concat(50*a,"px")},l={width:"".concat(20*a,"px"),height:"".concat(20*a,"px")},s={width:"".concat(35*a,"px"),height:"".concat(30*a,"px")},r=c.toString().length<=3?3*c.toString().length:10,u={top:"-".concat(r,"px"),right:"-".concat(r,"px")};return i.a.createElement("div",{className:"avatar"},i.a.createElement("div",{className:"avatarOut",style:o},i.a.createElement("div",{className:"avatarHead",style:l}),i.a.createElement("div",{className:"avatarTrunk",style:s})),c>0?i.a.createElement("span",{className:"badge",style:u},c):null)},C=function(e){var t,a,n=e.nickname,c=e._id,o=e.socketId,l=Object(s.useRecoilState)(m),r=Object(O.a)(l,2),u=r[0],d=r[1],f=Object(s.useSetRecoilState)(v.getAtom),b=(null===(t=u[c])||void 0===t?void 0:t.novistos)?u[c].novistos:0,g="";u[c]&&u[c].text&&(g=(null===(a=u[c].text[u[c].text.length-1])||void 0===a?void 0:a.msg)?u[c].text[u[c].text.length-1].msg:"");return i.a.createElement("div",{className:"contact contact-item",onClick:function(){var e=Object(y.a)(Object(y.a)({},u),{},{active:c,activeOnline:!0});e[c]?e[c]={nickname:n,socketId:o,text:Object(N.a)(u[c].text),novistos:0}:e[c]={nickname:n,text:[],socketId:o,novistos:0},d(e),f(v.posibleViews.CHAT)}},i.a.createElement(_,{novistos:b}),i.a.createElement("div",{className:"contactBody"},i.a.createElement("div",{className:"status"},i.a.createElement("span",{className:"nickname"},n),i.a.createElement("span",{className:"connectionStatus"})),i.a.createElement("div",{className:"lastMsg"},g)))},R=function(e){var t=Object(s.useRecoilValue)(u),a=Object(s.useRecoilState)(d),n=Object(O.a)(a,2),o=n[0],l=n[1];Object(c.useEffect)((function(){k.a.get("".concat(h.server,"/users")).then((function(e){200===e.status&&l(e.data.data.map((function(e){return{nick:e.nickname,_id:e._id,socketId:e.socketId}})).filter((function(e){return e._id!==t._id})))})).catch((function(e){return console.log(e)}))}),[]);return i.a.createElement("div",{style:{overflowY:"scroll",height:"calc(100% - 70px)"}},o.map((function(e){return i.a.createElement("div",{key:e._id},i.a.createElement(C,{nickname:e.nick,_id:e._id,socketId:e.socketId}))})))},w=a(54),I=function(e){var t=e.myMsg,a=void 0===t||t,n=e.msg,c=e.style,o=a?"mymsg":"notmymsg";return i.a.createElement("div",{className:"message ".concat(o),style:c},n)},T=function(e){var t=e.nickname,a=e.backClick,n=e.online,c=void 0===n||n;return i.a.createElement("div",{className:"contact contact-chat"},i.a.createElement("div",{className:"goBack",onClick:a}),i.a.createElement(_,{size:.8}),i.a.createElement("div",{className:"contactBody"},i.a.createElement("div",{className:"status"},i.a.createElement("span",{className:"nickname"},t),i.a.createElement("span",{className:"connectionStatus ".concat(c?"online":"offline")},c?"Online":"Offline"))))},A=function(e){var t=Object(s.useRecoilValue)(r),a=Object(s.useRecoilValue)(u),n=Object(s.useRecoilState)(m),o=Object(O.a)(n,2),l=o[0],d=o[1],f=Object(c.useRef)(""),b=Object(s.useSetRecoilState)(v.getAtom),g=S.getSocket(),k=function(){var e=f.current.innerText.replace(/^(\s*\r*)(.)(\s*\r*)$/,"$2");if(""!==e){var t=Object(y.a)({},l);t[t.active]=Object(y.a)({},t[l.active]),t[t.active].text=[].concat(Object(N.a)(t[t.active].text),[{myMsg:!0,msg:e}]),d(t),g.emit("message",{from:a._id,toUserId:l.active,toSocketId:l[l.active].socketId,msg:e}),f.current.innerText="",f.current.focus()}};Object(c.useEffect)((function(){var e=document.getElementById("chatConversation");e&&(e.scrollTop=e.scrollHeight)}));return i.a.createElement("div",{id:"chatContainer"},i.a.createElement(T,{backClick:function(){b(v.posibleViews.CONTACTS),d(Object(y.a)(Object(y.a)({},l),{},{active:null}))},nickname:l[l.active].nickname,online:l.activeOnline}),i.a.createElement("div",{id:"chatConversation"},l[l.active].text.map((function(e,t,a){var n={};return a[t+1]&&e.myMsg===a[t+1].myMsg&&(n.marginBottom="-3px",n.borderRadius=e.myMsg?"10px 0px 10px 10px":"0 10px 10px 10px"),t>0&&e.myMsg===a[t-1].myMsg&&(n.borderRadius=(e.myMsg,"10px 10px 10px 10px")),i.a.createElement(I,Object.assign({},e,{key:t,style:n}))}))),i.a.createElement("div",{id:"editor"},i.a.createElement("div",{id:"textarea",role:"textbox",contentEditable:l.activeOnline,ref:f,onKeyPress:function(e){l.activeOnline&&13===e.charCode&&k()}}),i.a.createElement("button",{id:"sendButton",disabled:!l.activeOnline,onClick:k},w.btnSend[t])))},V=function(e){var t=Object(s.useRecoilState)(r),a=Object(O.a)(t,2),n=a[0],c=a[1];return i.a.createElement("div",{className:"headerdiv"},i.a.createElement("div",{className:"infoapp"},i.a.createElement("div",{className:"apptitle"},"Chatapp")),i.a.createElement("select",{value:n,onChange:function(e){var t=e.target.value;c(t)},className:"idiomaselect"},i.a.createElement("option",{value:"es"},"ES"),i.a.createElement("option",{value:"en"},"EN")))},B=function(e){var t=Object(s.useRecoilState)(d),a=Object(O.a)(t,2),n=a[0],o=a[1],l=S.getSocket();return Object(c.useEffect)((function(){return l.on("new user",(function(e){o([].concat(Object(N.a)(n),[{nick:e.nickname,_id:e._id,socketId:e.socketId}]))})),function(){return l.off("new user")}}),[n]),i.a.createElement(i.a.Fragment,null)},M=function(e){var t=Object(s.useRecoilState)(d),a=Object(O.a)(t,2),n=a[0],o=a[1],l=Object(s.useRecoilState)(m),r=Object(O.a)(l,2),u=r[0],v=r[1],f=S.getSocket();return Object(c.useEffect)((function(){return f.on("user disconnect",(function(e){o(n.filter((function(t){return t._id!==e._id}))),u.active===e._id&&v(Object(y.a)(Object(y.a)({},u),{},{activeOnline:!1}))})),function(){return f.off("user disconnect")}}),[u]),i.a.createElement(i.a.Fragment,null)},L=function(e){var t=Object(s.useRecoilState)(m),a=Object(O.a)(t,2),n=a[0],o=a[1],l=S.getSocket();return Object(c.useEffect)((function(){return l.on("message",(function(e){var t=Object(y.a)({},n);n[e._id]?(t[e._id]=Object(y.a)({},n[e._id]),n[e._id].text?(t[e._id].text=[].concat(Object(N.a)(n[e._id].text),[{myMsg:!1,msg:e.msg}]),e._id!==t.active&&(t[e._id].novistos=t[e._id].novistos+1)):t[e._id].text=[]):t[e._id]={text:[{myMsg:!1,msg:e.msg}],nickname:null,socketId:null,novistos:1},o(t)})),function(){return l.off("message")}}),[n]),i.a.createElement(i.a.Fragment,null)},z=(a(131),function(e){var t=Object(s.useRecoilValue)(f);return t?(console.log("se muestra backdrop ".concat(t)),i.a.createElement("div",{className:"backdrop"},i.a.createElement("div",{class:"loader"},"Loading..."))):null});var F=function(){var e=Object(s.useRecoilValue)(v.getAtom),t=Object(s.useRecoilValue)(b),a=e===v.posibleViews.LOGIN?i.a.createElement(x,null):e===v.posibleViews.CONTACTS?i.a.createElement(R,null):i.a.createElement(A,null),n=null;return t&&(n=i.a.createElement(i.a.Fragment,null,i.a.createElement(B,null),i.a.createElement(M,null),i.a.createElement(L,null))),i.a.createElement(i.a.Fragment,null,i.a.createElement(z,null),i.a.createElement("div",{className:"main"},i.a.createElement(V,null),a,n))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(s.RecoilRoot,null,i.a.createElement(F,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},15:function(e){e.exports=JSON.parse('{"welcome":{"en":"Welcome to the chat","es":"Bienvenido al chat"},"placeholder":{"en":"Nickname","es":"Nombre de pila"},"txtBtn":{"en":"Begin","es":"Comenzar"}}')},54:function(e){e.exports=JSON.parse('{"btnSend":{"es":"Enviar","en":"Send"}}')},55:function(e,t,a){e.exports=a(132)},60:function(e,t,a){}},[[55,1,2]]]);
//# sourceMappingURL=main.488c98d0.chunk.js.map